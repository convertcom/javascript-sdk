"use strict";(()=>{var e={};e.id=183,e.ids=[183],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7147:e=>{e.exports=require("fs")},786:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>rT,patchFetch:()=>rv,requestAsyncStorage:()=>r_,routeModule:()=>rg,serverHooks:()=>rO,staticGenerationAsyncStorage:()=>rh});var n,r,a,o,s,l,u,d,c,E,g,_,h,O,T,v,A,f,R,p,N,C,I,S,D,L,U,m,y,M,F,P,b,k,w,H,B,G,x,V,q,j,W,K,Y,Q,$,z,X,J,Z,ee,et,ei,en,er,ea,eo,es,el,eu,ed,ec,eE,eg,e_,eh,eO,eT,ev,eA,ef,eR,ep,eN,eC,eI,eS,eD,eL,eU,em,ey,eM,eF,eP,eb,ek,ew,eH,eB,eG,ex,eV,eq,ej,eW,eK,eY,eQ,e$,ez,eX,eJ,eZ,e0,e5,e1,e4,e6,e3,e2,e9,e7,e8,te,tt,ti,tn,tr,ta,to,ts,tl,tu,td,tc,tE,tg,t_,th,tO,tT,tv,tA,tf,tR,tp,tN,tC,tI,tS,tD,tL,tU,tm,ty,tM,tF,tP,tb,tk,tw,tH,tB,tG,tx,tV,tq,tj,tW,tK,tY,tQ,t$,tz,tX,tJ,tZ,t0,t5,t1,t4,t6,t3,t2,t9,t7,t8,ie,it,ii,ir,ia,io,is,il,iu,id,ic,iE,ig,i_,ih,iO,iT,iv,iA,iR,ip,iN,iC,iI,iS,iD,iL,iU,im,iy,iM,iF,iP,ib,ik,iw,iH,iB,iG,ix,iV,iq,ij,iW,iK,iY,iQ,i$,iz,iX,iJ,iZ,i0,i5,i1,i4,i6,i3,i2,i9,i7,i8,ne,nt,ni,nn,nr,na,no,ns,nl={};i.r(nl),i.d(nl,{GET:()=>rE});var nu=i(9303),nd=i(8716),nc=i(670);function nE(e,t,i,n=!1){try{if("object"==typeof e){let i=t.split(".").reduce((e,t)=>e[t],e);if(i||n&&(!1===i||0===i))return i}}catch(e){}return null}function ng(e){return"object"==typeof e&&null!==e&&Object.keys(e).length>0}"function"==typeof SuppressedError&&SuppressedError,(l||(l={})).VARIAION_NOT_DECIDED="convert.com_variation_not_decided",(u||(u={})).FORCE_MULTIPLE_TRANSACTIONS="forceMultipleTransactions",function(e){e.OFF="OFF",e.EU_ONLY="EU ONLY",e.EEA_ONLY="EEA ONLY",e.WORLDWIDE="Worldwide"}(d||(d={})),function(e){e.AUDIENCE="audience",e.LOCATION="location",e.SEGMENT="segment",e.FEATURE="feature",e.GOAL="goal",e.EXPERIENCE="experience",e.VARIATION="variation"}(c||(c={})),function(e){e.ENABLED="enabled",e.DISABLED="disabled"}(E||(E={})),function(e){e.AMOUNT="amount",e.PRODUCTS_COUNT="productsCount",e.TRANSACTION_ID="transactionId"}(g||(g={})),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(_||(_={})),function(e){e.LOG="log",e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(h||(h={})),function(e){e.WEB="web",e.FULLSTACK="fullstack"}(O||(O={})),function(e){e.NO_DATA_FOUND="convert.com_no_data_found",e.NEED_MORE_DATA="convert.com_need_more_data"}(T||(T={})),function(e){e.READY="ready",e.CONFIG_UPDATED="config.updated",e.API_QUEUE_RELEASED="api.queue.released",e.BUCKETING="bucketing",e.CONVERSION="conversion",e.SEGMENTS="segments",e.LOCATION_ACTIVATED="location.activated",e.LOCATION_DEACTIVATED="location.deactivated",e.AUDIENCES="audiences",e.DATA_STORE_QUEUE_RELEASED="datastore.queue.released"}(v||(v={})),function(e){e.RICH_STRUCTURE="richStructure",e.CUSTOM_CODE="customCode",e.DEFAULT_CODE="defaultCode",e.DEFAULT_CODE_MULTIPAGE="defaultCodeMultipage",e.DEFAULT_REDIRECT="defaultRedirect",e.FULLSTACK_FEATURE="fullStackFeature"}(A||(A={})),function(e){e.IE="IE",e.CH="CH",e.FF="FF",e.OP="OP",e.SF="SF",e.EDG="EDG",e.MO="MO",e.NS="NS",e.OTH="OTH"}(f||(f={})),function(e){e.ALLPH="ALLPH",e.IPH="IPH",e.OTHPH="OTHPH",e.ALLTAB="ALLTAB",e.IPAD="IPAD",e.OTHTAB="OTHTAB",e.DESK="DESK",e.OTHDEV="OTHDEV"}(R||(R={})),function(e){e.COUNTRY="country",e.BROWSER="browser",e.DEVICES="devices",e.SOURCE="source",e.CAMPAIGN="campaign",e.VISITOR_TYPE="visitorType",e.CUSTOM_SEGMENTS="customSegments"}(p||(p={})),function(e){e.CAMPAIGN="campaign",e.SEARCH="search",e.REFERRAL="referral",e.DIRECT="direct"}(N||(N={})),function(e){e.NEW="new",e.RETURNING="returning"}(C||(C={}));let n_=class{static equals(e,t,i){return Array.isArray(e)?this._returnNegationCheck(-1!==e.indexOf(t),i):ng(e)?this._returnNegationCheck(-1!==Object.keys(e).indexOf(String(t)),i):(e=String(e),t=String(t),e=e.valueOf().toLowerCase(),t=t.valueOf().toLowerCase(),this._returnNegationCheck(e===t,i))}static less(e,t,i){return typeof e==typeof t&&this._returnNegationCheck(e<t,i)}static lessEqual(e,t,i){return typeof e==typeof t&&this._returnNegationCheck(e<=t,i)}static contains(e,t,i){return(e=String(e),t=String(t),e=e.valueOf().toLowerCase(),0===(t=t.valueOf().toLowerCase()).replace(/^([\s]*)|([\s]*)$/g,"").length)?this._returnNegationCheck(!0,i):this._returnNegationCheck(-1!==e.indexOf(t),i)}static isIn(e,t,i=!1,n="|"){let r=String(e).split(n).map(e=>String(e));"string"==typeof t&&(t=t.split(n)),Array.isArray(t)||(t=[]),t=t.map(e=>String(e).valueOf().toLowerCase());for(let e=0;e<r.length;e++)if(-1!==t.indexOf(r[e]))return this._returnNegationCheck(!0,i);return this._returnNegationCheck(!1,i)}static startsWith(e,t,i){return e=String(e).valueOf().toLowerCase(),t=String(t).valueOf().toLowerCase(),this._returnNegationCheck(0===e.indexOf(t),i)}static endsWith(e,t,i){return e=String(e).valueOf().toLowerCase(),t=String(t).valueOf().toLowerCase(),this._returnNegationCheck(-1!==e.indexOf(t,e.length-t.length),i)}static regexMatches(e,t,i){e=String(e).valueOf().toLowerCase();let n=RegExp(t=String(t).valueOf(),"i");return this._returnNegationCheck(n.test(e),i)}static _returnNegationCheck(e,t=!1){return t?!e:e}};n_.equalsNumber=n_.equals,n_.matches=n_.equals,"function"==typeof SuppressedError&&SuppressedError,(I||(I={})).VARIAION_NOT_DECIDED="convert.com_variation_not_decided",(S||(S={})).FORCE_MULTIPLE_TRANSACTIONS="forceMultipleTransactions";let nh={UNABLE_TO_PERFORM_NETWORK_REQUEST:"Unable to perform network request",UNSUPPORTED_RESPONSE_TYPE:"Unsupported response type"},nO={SEND_BEACON_SUCCESS:"The user agent successfully queued the data for transfer"};(function(e){e.OFF="OFF",e.EU_ONLY="EU ONLY",e.EEA_ONLY="EEA ONLY",e.WORLDWIDE="Worldwide"})(D||(D={})),function(e){e.AUDIENCE="audience",e.LOCATION="location",e.SEGMENT="segment",e.FEATURE="feature",e.GOAL="goal",e.EXPERIENCE="experience",e.VARIATION="variation"}(L||(L={})),function(e){e.ENABLED="enabled",e.DISABLED="disabled"}(U||(U={})),function(e){e.AMOUNT="amount",e.PRODUCTS_COUNT="productsCount",e.TRANSACTION_ID="transactionId"}(m||(m={})),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(y||(y={})),function(e){e.LOG="log",e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(M||(M={})),function(e){e.WEB="web",e.FULLSTACK="fullstack"}(F||(F={})),function(e){e.NO_DATA_FOUND="convert.com_no_data_found",e.NEED_MORE_DATA="convert.com_need_more_data"}(P||(P={})),function(e){e.READY="ready",e.CONFIG_UPDATED="config.updated",e.API_QUEUE_RELEASED="api.queue.released",e.BUCKETING="bucketing",e.CONVERSION="conversion",e.SEGMENTS="segments",e.LOCATION_ACTIVATED="location.activated",e.LOCATION_DEACTIVATED="location.deactivated",e.AUDIENCES="audiences",e.DATA_STORE_QUEUE_RELEASED="datastore.queue.released"}(b||(b={})),function(e){e.RICH_STRUCTURE="richStructure",e.CUSTOM_CODE="customCode",e.DEFAULT_CODE="defaultCode",e.DEFAULT_CODE_MULTIPAGE="defaultCodeMultipage",e.DEFAULT_REDIRECT="defaultRedirect",e.FULLSTACK_FEATURE="fullStackFeature"}(k||(k={})),function(e){e.IE="IE",e.CH="CH",e.FF="FF",e.OP="OP",e.SF="SF",e.EDG="EDG",e.MO="MO",e.NS="NS",e.OTH="OTH"}(w||(w={})),function(e){e.ALLPH="ALLPH",e.IPH="IPH",e.OTHPH="OTHPH",e.ALLTAB="ALLTAB",e.IPAD="IPAD",e.OTHTAB="OTHTAB",e.DESK="DESK",e.OTHDEV="OTHDEV"}(H||(H={})),function(e){e.COUNTRY="country",e.BROWSER="browser",e.DEVICES="devices",e.SOURCE="source",e.CAMPAIGN="campaign",e.VISITOR_TYPE="visitorType",e.CUSTOM_SEGMENTS="customSegments"}(B||(B={})),function(e){e.CAMPAIGN="campaign",e.SEARCH="search",e.REFERRAL="referral",e.DIRECT="direct"}(G||(G={})),function(e){e.NEW="new",e.RETURNING="returning"}(x||(x={})),function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.ImUsed=226]="ImUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.UriTooLong=414]="UriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RangeNotSatisfiable=416]="RangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired"}(V||(V={}));let nT=()=>{if("function"==typeof fetch)return{runtime:"server-with-fetch"};try{let e=require("url"),t=require("http"),i=require("https"),n=require("querystring");return{runtime:"old-nodejs",url:e,http:t,https:i,queryString:n}}catch(e){}return{runtime:"unknown"}},nv=e=>!["GET","HEAD","DELETE","TRACE","OPTIONS"].includes(e.toUpperCase()),nA=(e,t,i)=>{let n="";return ng(e)&&!nv(t)&&(n="old-nodejs"!==i.runtime?Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&"):i.queryString.stringify(e)),n?`?${n}`:n},nf={request(e){var t;let i=(null===(t=null==e?void 0:e.method)||void 0===t?void 0:t.toUpperCase())||"GET",n=(null==e?void 0:e.path)?e.path.startsWith("/")?e.path:`/${e.path}`:"",r=e.baseURL.endsWith("/")?e.baseURL.slice(0,-1):e.baseURL,a=(null==e?void 0:e.responseType)||"json",o=nT();return new Promise((t,s)=>{if("browser"===o.runtime||"server-with-fetch"===o.runtime){let l={method:i,keepalive:!0};(null==e?void 0:e.headers)&&(l.headers=e.headers),(null==e?void 0:e.data)&&nv(i)&&(l.body=JSON.stringify(e.data));let u=`${r}${n}${nA(null==e?void 0:e.data,i,o)}`;"post"===i.toLowerCase()&&"undefined"!=typeof navigator&&(null==navigator?void 0:navigator.sendBeacon)?navigator.sendBeacon(u,l.body)?t({data:!0,status:V.Ok,statusText:nO.SEND_BEACON_SUCCESS}):s({message:nh.UNSUPPORTED_RESPONSE_TYPE}):fetch(u,l).then(e=>{var i,n,r;return i=this,n=void 0,r=function*(){if(e.status===V.Ok){let i={status:e.status,statusText:e.statusText,headers:e.headers,data:null};switch(a){case"json":i.data=yield e.json();break;case"arraybuffer":i.data=yield e.arrayBuffer();break;case"text":i.data=e;break;default:s({message:nh.UNSUPPORTED_RESPONSE_TYPE});return}t(i)}else s({message:e.statusText,status:e.status})},new(n||(n=Promise))(function(e,t){function a(e){try{s(r.next(e))}catch(e){t(e)}}function o(e){try{s(r.throw(e))}catch(e){t(e)}}function s(t){var i;t.done?e(t.value):((i=t.value)instanceof n?i:new n(function(e){e(i)})).then(a,o)}s((r=r.apply(i,[])).next())})}).catch(e=>{s({message:null==e?void 0:e.message,status:null==e?void 0:e.status,statusText:null==e?void 0:e.statusText})})}else if("old-nodejs"===o.runtime){let l=o.url.parse(r);l.port||(l.port="https:"===l.protocol?"443":"80");let u=l.path.endsWith("/")?l.path.slice(0,-1):l.path,d="https:"===l.protocol?o.https:o.http,c=[],E={hostname:l.hostname,path:`${u}${n}${nA(null==e?void 0:e.data,i,o)}`,port:l.port,method:i},g=(null==e?void 0:e.data)&&nv(i)?JSON.stringify(e.data):null;(null==e?void 0:e.headers)&&(E.headers=e.headers),g&&(E.headers||(E.headers={}),E.headers["Content-Length"]=Buffer.byteLength(g));let _=d.request(E,e=>{e.on("data",e=>c.push(e)),e.on("end",()=>{if(e.statusCode===V.Ok){let i=Buffer.concat(c),n=i.toString(),r={status:e.statusCode,statusText:e.statusMessage,headers:e.headers,data:null};switch(a){case"json":r.data=n?JSON.parse(n):"";break;case"arraybuffer":r.data=null==i?void 0:i.buffer;break;case"text":r.data=e;break;default:s({message:nh.UNSUPPORTED_RESPONSE_TYPE});return}t(r)}else s({message:e.statusMessage,status:e.statusCode})})});_.on("error",e=>{s({message:null==e?void 0:e.message,status:null==e?void 0:e.code,statusText:null==e?void 0:e.statusText})}),g&&_.write(g),_.end()}else s({message:nh.UNABLE_TO_PERFORM_NETWORK_REQUEST})})}};n={exports:{}},function(){let e=e=>new TextEncoder().encode(e);function t(t,i){let n,r,a,o,s,l;for("string"==typeof t&&(t=e(t)),n=3&t.length,r=t.length-n,a=i,l=0;l<r;)s=255&t[l]|(255&t[++l])<<8|(255&t[++l])<<16|(255&t[++l])<<24,++l,a^=s=(65535&(s=(s=(65535&s)*3432918353+(((s>>>16)*3432918353&65535)<<16)&4294967295)<<15|s>>>17))*461845907+(((s>>>16)*461845907&65535)<<16)&4294967295,a=(65535&(o=(65535&(a=a<<13|a>>>19))*5+(((a>>>16)*5&65535)<<16)&4294967295))+27492+(((o>>>16)+58964&65535)<<16);switch(s=0,n){case 3:s^=(255&t[l+2])<<16;case 2:s^=(255&t[l+1])<<8;case 1:s^=255&t[l],a^=s=(65535&(s=(s=(65535&s)*3432918353+(((s>>>16)*3432918353&65535)<<16)&4294967295)<<15|s>>>17))*461845907+(((s>>>16)*461845907&65535)<<16)&4294967295}return a^=t.length,a^=a>>>16,a=(65535&a)*2246822507+(((a>>>16)*2246822507&65535)<<16)&4294967295,a^=a>>>13,a=(65535&a)*3266489909+(((a>>>16)*3266489909&65535)<<16)&4294967295,(a^=a>>>16)>>>0}t.v2=function(t,i){"string"==typeof t&&(t=e(t));let n=t.length,r=i^n,a=0,o;for(;n>=4;)o=(65535&(o=255&t[a]|(255&t[++a])<<8|(255&t[++a])<<16|(255&t[++a])<<24))*1540483477+(((o>>>16)*1540483477&65535)<<16),o^=o>>>24,r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16)^(o=(65535&o)*1540483477+(((o>>>16)*1540483477&65535)<<16)),n-=4,++a;switch(n){case 3:r^=(255&t[a+2])<<16;case 2:r^=(255&t[a+1])<<8;case 1:r^=255&t[a],r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16)}return r^=r>>>13,r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16),(r^=r>>>15)>>>0},t.v3=t,n.exports=t}();let nR="https://cdn-4.convertexperiments.com/api/v1/",np="https://[project_id].metrics.convertexperiments.com/v1/",nN={"Content-Type":"application/json"};class nC{constructor(e,{eventManager:t,loggerManager:i}={}){var n,r,a,o,s,l,u,d,c,E,g,_;this._configEndpoint=nR,this._trackEndpoint=np,this._defaultHeaders=nN,this.batchSize=10,this.releaseInterval=1e4,this._loggerManager=i,this._eventManager=t,this._configEndpoint=(null===(r=null===(n=null==e?void 0:e.api)||void 0===n?void 0:n.endpoint)||void 0===r?void 0:r.config)||nR,this._trackEndpoint=(null===(o=null===(a=null==e?void 0:e.api)||void 0===a?void 0:a.endpoint)||void 0===o?void 0:o.track)||np,this._data=nE(e,"data"),this._enrichData=!nE(e,"dataStore"),this._environment=null==e?void 0:e.environment,this._mapper=(null==e?void 0:e.mapper)||(e=>e),this.batchSize=Number(null===(s=null==e?void 0:e.events)||void 0===s?void 0:s.batch_size)||10,this.releaseInterval=Number(null===(l=null==e?void 0:e.events)||void 0===l?void 0:l.release_interval)||1e4,this._accountId=null===(u=this._data)||void 0===u?void 0:u.account_id,this._projectId=null===(c=null===(d=this._data)||void 0===d?void 0:d.project)||void 0===c?void 0:c.id,this._sdkKey=(null==e?void 0:e.sdkKey)||`${this._accountId}/${this._projectId}`,(null==e?void 0:e.sdkKeySecret)&&(this._defaultHeaders.Authorization=`Bearer ${null==e?void 0:e.sdkKeySecret}`),this._trackingEvent={enrichData:this._enrichData,accountId:this._accountId,projectId:this._projectId,visitors:[]},this._trackingEnabled=null===(E=null==e?void 0:e.network)||void 0===E?void 0:E.tracking,this._trackingSource=(null===(g=null==e?void 0:e.network)||void 0===g?void 0:g.source)||"js-sdk",this._cacheLevel=null===(_=null==e?void 0:e.network)||void 0===_?void 0:_.cacheLevel,this._requestsQueue={length:0,items:[],push(e,t,i){let n=this.items.findIndex(t=>t.visitorId===e);if(-1!==n)this.items[n].events.push(t);else{let n={visitorId:e,events:[t]};i&&(n.segments=i),this.items.push(n)}this.length++},reset(){this.items=[],this.length=0}}}request(e,t){var i,n,r,a;return i=this,n=arguments,r=void 0,a=function*(e,t,i={},n={}){let r=Object.assign(Object.assign({},this._defaultHeaders),n),a={method:e,path:t.route,baseURL:t.base,headers:r,data:i,responseType:"json"};return nf.request(a)},new(r||(r=Promise))(function(e,t){function o(e){try{l(a.next(e))}catch(e){t(e)}}function s(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){var i;t.done?e(t.value):((i=t.value)instanceof r?i:new r(function(e){e(i)})).then(o,s)}l((a=a.apply(i,n||[])).next())})}enqueue(e,t,i){var n,r;null===(r=null===(n=this._loggerManager)||void 0===n?void 0:n.trace)||void 0===r||r.call(n,"ApiManager.enqueue()",this._mapper({eventRequest:t})),this._requestsQueue.push(e,t,i),this._trackingEnabled&&(this._requestsQueue.length===this.batchSize?this.releaseQueue("size").then():1===this._requestsQueue.length&&this.startQueue())}releaseQueue(e){var t,i;if(!this._requestsQueue.length)return;null===(i=null===(t=this._loggerManager)||void 0===t?void 0:t.info)||void 0===i||i.call(t,"ApiManager.releaseQueue()",{reason:e||""}),this.stopQueue();let n=this._trackingEvent;return n.visitors=this._requestsQueue.items.slice(),n.source=this._trackingSource,this.request("post",{base:this._trackEndpoint.replace("[project_id]",this._projectId.toString()),route:`/track/${this._sdkKey}`},this._mapper(n)).then(t=>{var i,r;this._requestsQueue.reset(),null===(r=null===(i=this._eventManager)||void 0===i?void 0:i.fire)||void 0===r||r.call(i,v.API_QUEUE_RELEASED,{reason:e,result:t,visitors:n.visitors})}).catch(t=>{var i,n,r,a;null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.error)||void 0===n||n.call(i,"ApiManager.releaseQueue()",{error:t.message}),this.startQueue(),null===(a=null===(r=this._eventManager)||void 0===r?void 0:r.fire)||void 0===a||a.call(r,v.API_QUEUE_RELEASED,{reason:e},t)})}stopQueue(){clearTimeout(this._requestsQueueTimerID)}startQueue(){this._requestsQueueTimerID=setTimeout(()=>{this.releaseQueue("timeout")},this.releaseInterval)}enableTracking(){this._trackingEnabled=!0,this.releaseQueue("trackingEnabled")}disableTracking(){this._trackingEnabled=!1}setData(e){var t;this._data=e,this._accountId=null==e?void 0:e.account_id,this._projectId=null===(t=null==e?void 0:e.project)||void 0===t?void 0:t.id,this._trackingEvent.accountId=this._accountId,this._trackingEvent.projectId=this._projectId}getConfig(){var e,t;null===(t=null===(e=this._loggerManager)||void 0===e?void 0:e.trace)||void 0===t||t.call(e,"ApiManager.getConfig()");let i="low"===this._cacheLevel||this._environment?"?":"";return this._environment&&(i+=`environment=${this._environment}`),"low"===this._cacheLevel&&(i+="_conv_low_cache=1"),new Promise((e,t)=>{this.request("get",{base:this._configEndpoint,route:`/config/${this._sdkKey}${i}`}).then(({data:t})=>e(t)).catch(t)})}}let nI=class{static equals(e,t,i){var n;return Array.isArray(e)?this._returnNegationCheck(-1!==e.indexOf(t),i):"object"==typeof(n=e)&&null!==n&&Object.keys(n).length>0?this._returnNegationCheck(-1!==Object.keys(e).indexOf(String(t)),i):(e=String(e),t=String(t),e=e.valueOf().toLowerCase(),t=t.valueOf().toLowerCase(),this._returnNegationCheck(e===t,i))}static less(e,t,i){return typeof e==typeof t&&this._returnNegationCheck(e<t,i)}static lessEqual(e,t,i){return typeof e==typeof t&&this._returnNegationCheck(e<=t,i)}static contains(e,t,i){return(e=String(e),t=String(t),e=e.valueOf().toLowerCase(),0===(t=t.valueOf().toLowerCase()).replace(/^([\s]*)|([\s]*)$/g,"").length)?this._returnNegationCheck(!0,i):this._returnNegationCheck(-1!==e.indexOf(t),i)}static isIn(e,t,i=!1,n="|"){let r=String(e).split(n).map(e=>String(e));"string"==typeof t&&(t=t.split(n)),Array.isArray(t)||(t=[]),t=t.map(e=>String(e).valueOf().toLowerCase());for(let e=0;e<r.length;e++)if(-1!==t.indexOf(r[e]))return this._returnNegationCheck(!0,i);return this._returnNegationCheck(!1,i)}static startsWith(e,t,i){return e=String(e).valueOf().toLowerCase(),t=String(t).valueOf().toLowerCase(),this._returnNegationCheck(0===e.indexOf(t),i)}static endsWith(e,t,i){return e=String(e).valueOf().toLowerCase(),t=String(t).valueOf().toLowerCase(),this._returnNegationCheck(-1!==e.indexOf(t,e.length-t.length),i)}static regexMatches(e,t,i){e=String(e).valueOf().toLowerCase();let n=RegExp(t=String(t).valueOf(),"i");return this._returnNegationCheck(n.test(e),i)}static _returnNegationCheck(e,t=!1){return t?!e:e}};nI.equalsNumber=nI.equals,nI.matches=nI.equals,"function"==typeof SuppressedError&&SuppressedError,(q||(q={})).VARIAION_NOT_DECIDED="convert.com_variation_not_decided",(j||(j={})).FORCE_MULTIPLE_TRANSACTIONS="forceMultipleTransactions",function(e){e.OFF="OFF",e.EU_ONLY="EU ONLY",e.EEA_ONLY="EEA ONLY",e.WORLDWIDE="Worldwide"}(W||(W={})),function(e){e.AUDIENCE="audience",e.LOCATION="location",e.SEGMENT="segment",e.FEATURE="feature",e.GOAL="goal",e.EXPERIENCE="experience",e.VARIATION="variation"}(K||(K={})),function(e){e.ENABLED="enabled",e.DISABLED="disabled"}(Y||(Y={})),function(e){e.AMOUNT="amount",e.PRODUCTS_COUNT="productsCount",e.TRANSACTION_ID="transactionId"}(Q||(Q={})),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}($||($={})),function(e){e.LOG="log",e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(z||(z={})),function(e){e.WEB="web",e.FULLSTACK="fullstack"}(X||(X={})),function(e){e.NO_DATA_FOUND="convert.com_no_data_found",e.NEED_MORE_DATA="convert.com_need_more_data"}(J||(J={})),function(e){e.READY="ready",e.CONFIG_UPDATED="config.updated",e.API_QUEUE_RELEASED="api.queue.released",e.BUCKETING="bucketing",e.CONVERSION="conversion",e.SEGMENTS="segments",e.LOCATION_ACTIVATED="location.activated",e.LOCATION_DEACTIVATED="location.deactivated",e.AUDIENCES="audiences",e.DATA_STORE_QUEUE_RELEASED="datastore.queue.released"}(Z||(Z={})),function(e){e.RICH_STRUCTURE="richStructure",e.CUSTOM_CODE="customCode",e.DEFAULT_CODE="defaultCode",e.DEFAULT_CODE_MULTIPAGE="defaultCodeMultipage",e.DEFAULT_REDIRECT="defaultRedirect",e.FULLSTACK_FEATURE="fullStackFeature"}(ee||(ee={})),function(e){e.IE="IE",e.CH="CH",e.FF="FF",e.OP="OP",e.SF="SF",e.EDG="EDG",e.MO="MO",e.NS="NS",e.OTH="OTH"}(et||(et={})),function(e){e.ALLPH="ALLPH",e.IPH="IPH",e.OTHPH="OTHPH",e.ALLTAB="ALLTAB",e.IPAD="IPAD",e.OTHTAB="OTHTAB",e.DESK="DESK",e.OTHDEV="OTHDEV"}(ei||(ei={})),function(e){e.COUNTRY="country",e.BROWSER="browser",e.DEVICES="devices",e.SOURCE="source",e.CAMPAIGN="campaign",e.VISITOR_TYPE="visitorType",e.CUSTOM_SEGMENTS="customSegments"}(en||(en={})),function(e){e.CAMPAIGN="campaign",e.SEARCH="search",e.REFERRAL="referral",e.DIRECT="direct"}(er||(er={})),function(e){e.NEW="new",e.RETURNING="returning"}(ea||(ea={})),function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.ImUsed=226]="ImUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.UriTooLong=414]="UriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RangeNotSatisfiable=416]="RangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired"}(eo||(eo={}));var nS={exports:{}};(function(){let e=e=>new TextEncoder().encode(e);function t(t,i){let n,r,a,o,s,l;for("string"==typeof t&&(t=e(t)),n=3&t.length,r=t.length-n,a=i,l=0;l<r;)s=255&t[l]|(255&t[++l])<<8|(255&t[++l])<<16|(255&t[++l])<<24,++l,a^=s=(65535&(s=(s=(65535&s)*3432918353+(((s>>>16)*3432918353&65535)<<16)&4294967295)<<15|s>>>17))*461845907+(((s>>>16)*461845907&65535)<<16)&4294967295,a=(65535&(o=(65535&(a=a<<13|a>>>19))*5+(((a>>>16)*5&65535)<<16)&4294967295))+27492+(((o>>>16)+58964&65535)<<16);switch(s=0,n){case 3:s^=(255&t[l+2])<<16;case 2:s^=(255&t[l+1])<<8;case 1:s^=255&t[l],a^=s=(65535&(s=(s=(65535&s)*3432918353+(((s>>>16)*3432918353&65535)<<16)&4294967295)<<15|s>>>17))*461845907+(((s>>>16)*461845907&65535)<<16)&4294967295}return a^=t.length,a^=a>>>16,a=(65535&a)*2246822507+(((a>>>16)*2246822507&65535)<<16)&4294967295,a^=a>>>13,a=(65535&a)*3266489909+(((a>>>16)*3266489909&65535)<<16)&4294967295,(a^=a>>>16)>>>0}t.v2=function(t,i){"string"==typeof t&&(t=e(t));let n=t.length,r=i^n,a=0,o;for(;n>=4;)o=(65535&(o=255&t[a]|(255&t[++a])<<8|(255&t[++a])<<16|(255&t[++a])<<24))*1540483477+(((o>>>16)*1540483477&65535)<<16),o^=o>>>24,r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16)^(o=(65535&o)*1540483477+(((o>>>16)*1540483477&65535)<<16)),n-=4,++a;switch(n){case 3:r^=(255&t[a+2])<<16;case 2:r^=(255&t[a+1])<<8;case 1:r^=255&t[a],r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16)}return r^=r>>>13,r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16),(r^=r>>>15)>>>0},t.v3=t,nS.exports=t})();var nD=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(nS.exports);(es||(es={})).VARIAION_NOT_DECIDED="convert.com_variation_not_decided",(el||(el={})).FORCE_MULTIPLE_TRANSACTIONS="forceMultipleTransactions";let nL={BUCKETING_CONSTRUCTOR:"Bucketing Manager constructor has been called"};(function(e){e.OFF="OFF",e.EU_ONLY="EU ONLY",e.EEA_ONLY="EEA ONLY",e.WORLDWIDE="Worldwide"})(eu||(eu={})),function(e){e.AUDIENCE="audience",e.LOCATION="location",e.SEGMENT="segment",e.FEATURE="feature",e.GOAL="goal",e.EXPERIENCE="experience",e.VARIATION="variation"}(ed||(ed={})),function(e){e.ENABLED="enabled",e.DISABLED="disabled"}(ec||(ec={})),function(e){e.AMOUNT="amount",e.PRODUCTS_COUNT="productsCount",e.TRANSACTION_ID="transactionId"}(eE||(eE={})),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(eg||(eg={})),function(e){e.LOG="log",e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(e_||(e_={})),function(e){e.WEB="web",e.FULLSTACK="fullstack"}(eh||(eh={})),function(e){e.NO_DATA_FOUND="convert.com_no_data_found",e.NEED_MORE_DATA="convert.com_need_more_data"}(eO||(eO={})),function(e){e.READY="ready",e.CONFIG_UPDATED="config.updated",e.API_QUEUE_RELEASED="api.queue.released",e.BUCKETING="bucketing",e.CONVERSION="conversion",e.SEGMENTS="segments",e.LOCATION_ACTIVATED="location.activated",e.LOCATION_DEACTIVATED="location.deactivated",e.AUDIENCES="audiences",e.DATA_STORE_QUEUE_RELEASED="datastore.queue.released"}(eT||(eT={})),function(e){e.RICH_STRUCTURE="richStructure",e.CUSTOM_CODE="customCode",e.DEFAULT_CODE="defaultCode",e.DEFAULT_CODE_MULTIPAGE="defaultCodeMultipage",e.DEFAULT_REDIRECT="defaultRedirect",e.FULLSTACK_FEATURE="fullStackFeature"}(ev||(ev={})),function(e){e.IE="IE",e.CH="CH",e.FF="FF",e.OP="OP",e.SF="SF",e.EDG="EDG",e.MO="MO",e.NS="NS",e.OTH="OTH"}(eA||(eA={})),function(e){e.ALLPH="ALLPH",e.IPH="IPH",e.OTHPH="OTHPH",e.ALLTAB="ALLTAB",e.IPAD="IPAD",e.OTHTAB="OTHTAB",e.DESK="DESK",e.OTHDEV="OTHDEV"}(ef||(ef={})),function(e){e.COUNTRY="country",e.BROWSER="browser",e.DEVICES="devices",e.SOURCE="source",e.CAMPAIGN="campaign",e.VISITOR_TYPE="visitorType",e.CUSTOM_SEGMENTS="customSegments"}(eR||(eR={})),function(e){e.CAMPAIGN="campaign",e.SEARCH="search",e.REFERRAL="referral",e.DIRECT="direct"}(ep||(ep={})),function(e){e.NEW="new",e.RETURNING="returning"}(eN||(eN={}));class nU{constructor(e,{loggerManager:t}={}){var i,n,r,a;this._max_traffic=1e4,this._hash_seed=9999,this._loggerManager=t,this._max_traffic=(null===(i=null==e?void 0:e.bucketing)||void 0===i?void 0:i.max_traffic)||1e4,this._hash_seed=(null===(n=null==e?void 0:e.bucketing)||void 0===n?void 0:n.hash_seed)||9999,null===(a=null===(r=this._loggerManager)||void 0===r?void 0:r.trace)||void 0===a||a.call(r,"BucketingManager()",nL.BUCKETING_CONSTRUCTOR,this)}selectBucket(e,t,i=0){var n,r;let a=null,o=0;return Object.keys(e).some(n=>t<(o+=100*e[n]+i)&&(a=n,!0)),null===(r=null===(n=this._loggerManager)||void 0===n?void 0:n.debug)||void 0===r||r.call(n,"BucketingManager.selectBucket()",{buckets:e,value:t,redistribute:i},{variation:a}),a||null}getValueVisitorBased(e,t){var i,n;let{seed:r=this._hash_seed,experienceId:a=""}=t||{},o=function(e,t=9999){return nD.v3(String(e),t)}(a+String(e),r)/4294967296*this._max_traffic,s=parseInt(String(o),10);return null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.debug)||void 0===n||n.call(i,"BucketingManager.getValueVisitorBased()",{visitorId:e,seed:r,experienceId:a,val:o,result:s}),s}getBucketForVisitor(e,t,i){let n=this.getValueVisitorBased(t,i),r=this.selectBucket(e,n,null==i?void 0:i.redistribute);return r?{variationId:r,bucketingAllocation:n}:null}}function nm(e,t,i,n){return new(i||(i=Promise))(function(r,a){function o(e){try{l(n.next(e))}catch(e){a(e)}}function s(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,s)}l((n=n.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError,(eC||(eC={})).VARIAION_NOT_DECIDED="convert.com_variation_not_decided",(eI||(eI={})).FORCE_MULTIPLE_TRANSACTIONS="forceMultipleTransactions";let ny={DATA_OBJECT_MISSING:"Data object is missing",SDK_OR_DATA_OBJECT_REQUIRED:"SDK key or Data object should be provided",VISITOR_ID_REQUIRED:"Visitor string string is not present",GOAL_DATA_NOT_VALID:"GoalData object is not valid"},nM={CONFIG_DATA_UPDATED:"Config Data updated",CORE_CONSTRUCTOR:"Core Manager constructor has been called",CORE_INITIALIZED:"Core Manager has been initialized",VARIATION_CHANGE_NOT_SUPPORTED:"Variation change not supported",FEATURE_CONSTRUCTOR:"Feature Manager constructor has been called",FEATURE_NOT_FOUND:"Fullstack Feature not found",FEATURE_VARIABLES_NOT_FOUND:"Fullstack Feature Variables not found",FEATURE_VARIABLES_TYPE_NOT_FOUND:"Fullstack Feature Variables Type not found"};function nF(e){return Array.isArray(e)&&e.length>0}function nP(...e){let t=e=>e&&"object"==typeof e;return e.reduce((e,i)=>(Object.keys(i).forEach(n=>{let r=e[n],a=i[n];Array.isArray(r)&&Array.isArray(a)?e[n]=[...new Set([...a,...r])]:t(r)&&t(a)?e[n]=nP(r,a):e[n]=a}),e),{})}function nb(e){return"object"==typeof e&&null!==e&&Object.keys(e).length>0}(function(e){e.OFF="OFF",e.EU_ONLY="EU ONLY",e.EEA_ONLY="EEA ONLY",e.WORLDWIDE="Worldwide"})(eS||(eS={})),function(e){e.AUDIENCE="audience",e.LOCATION="location",e.SEGMENT="segment",e.FEATURE="feature",e.GOAL="goal",e.EXPERIENCE="experience",e.VARIATION="variation"}(eD||(eD={})),function(e){e.ENABLED="enabled",e.DISABLED="disabled"}(eL||(eL={})),function(e){e.AMOUNT="amount",e.PRODUCTS_COUNT="productsCount",e.TRANSACTION_ID="transactionId"}(eU||(eU={})),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(em||(em={})),function(e){e.LOG="log",e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(ey||(ey={})),function(e){e.WEB="web",e.FULLSTACK="fullstack"}(eM||(eM={})),function(e){e.NO_DATA_FOUND="convert.com_no_data_found",e.NEED_MORE_DATA="convert.com_need_more_data"}(eF||(eF={})),function(e){e.READY="ready",e.CONFIG_UPDATED="config.updated",e.API_QUEUE_RELEASED="api.queue.released",e.BUCKETING="bucketing",e.CONVERSION="conversion",e.SEGMENTS="segments",e.LOCATION_ACTIVATED="location.activated",e.LOCATION_DEACTIVATED="location.deactivated",e.AUDIENCES="audiences",e.DATA_STORE_QUEUE_RELEASED="datastore.queue.released"}(eP||(eP={})),function(e){e.RICH_STRUCTURE="richStructure",e.CUSTOM_CODE="customCode",e.DEFAULT_CODE="defaultCode",e.DEFAULT_CODE_MULTIPAGE="defaultCodeMultipage",e.DEFAULT_REDIRECT="defaultRedirect",e.FULLSTACK_FEATURE="fullStackFeature"}(eb||(eb={})),function(e){e.IE="IE",e.CH="CH",e.FF="FF",e.OP="OP",e.SF="SF",e.EDG="EDG",e.MO="MO",e.NS="NS",e.OTH="OTH"}(ek||(ek={})),function(e){e.ALLPH="ALLPH",e.IPH="IPH",e.OTHPH="OTHPH",e.ALLTAB="ALLTAB",e.IPAD="IPAD",e.OTHTAB="OTHTAB",e.DESK="DESK",e.OTHDEV="OTHDEV"}(ew||(ew={})),function(e){e.COUNTRY="country",e.BROWSER="browser",e.DEVICES="devices",e.SOURCE="source",e.CAMPAIGN="campaign",e.VISITOR_TYPE="visitorType",e.CUSTOM_SEGMENTS="customSegments"}(eH||(eH={})),function(e){e.CAMPAIGN="campaign",e.SEARCH="search",e.REFERRAL="referral",e.DIRECT="direct"}(eB||(eB={})),function(e){e.NEW="new",e.RETURNING="returning"}(eG||(eG={}));let nk=class{static equals(e,t,i){return Array.isArray(e)?this._returnNegationCheck(-1!==e.indexOf(t),i):nb(e)?this._returnNegationCheck(-1!==Object.keys(e).indexOf(String(t)),i):(e=String(e),t=String(t),e=e.valueOf().toLowerCase(),t=t.valueOf().toLowerCase(),this._returnNegationCheck(e===t,i))}static less(e,t,i){return typeof e==typeof t&&this._returnNegationCheck(e<t,i)}static lessEqual(e,t,i){return typeof e==typeof t&&this._returnNegationCheck(e<=t,i)}static contains(e,t,i){return(e=String(e),t=String(t),e=e.valueOf().toLowerCase(),0===(t=t.valueOf().toLowerCase()).replace(/^([\s]*)|([\s]*)$/g,"").length)?this._returnNegationCheck(!0,i):this._returnNegationCheck(-1!==e.indexOf(t),i)}static isIn(e,t,i=!1,n="|"){let r=String(e).split(n).map(e=>String(e));"string"==typeof t&&(t=t.split(n)),Array.isArray(t)||(t=[]),t=t.map(e=>String(e).valueOf().toLowerCase());for(let e=0;e<r.length;e++)if(-1!==t.indexOf(r[e]))return this._returnNegationCheck(!0,i);return this._returnNegationCheck(!1,i)}static startsWith(e,t,i){return e=String(e).valueOf().toLowerCase(),t=String(t).valueOf().toLowerCase(),this._returnNegationCheck(0===e.indexOf(t),i)}static endsWith(e,t,i){return e=String(e).valueOf().toLowerCase(),t=String(t).valueOf().toLowerCase(),this._returnNegationCheck(-1!==e.indexOf(t,e.length-t.length),i)}static regexMatches(e,t,i){e=String(e).valueOf().toLowerCase();let n=RegExp(t=String(t).valueOf(),"i");return this._returnNegationCheck(n.test(e),i)}static _returnNegationCheck(e,t=!1){return t?!e:e}};nk.equalsNumber=nk.equals,nk.matches=nk.equals,"function"==typeof SuppressedError&&SuppressedError,(ex||(ex={})).VARIAION_NOT_DECIDED="convert.com_variation_not_decided",(eV||(eV={})).FORCE_MULTIPLE_TRANSACTIONS="forceMultipleTransactions",function(e){e.OFF="OFF",e.EU_ONLY="EU ONLY",e.EEA_ONLY="EEA ONLY",e.WORLDWIDE="Worldwide"}(eq||(eq={})),function(e){e.AUDIENCE="audience",e.LOCATION="location",e.SEGMENT="segment",e.FEATURE="feature",e.GOAL="goal",e.EXPERIENCE="experience",e.VARIATION="variation"}(ej||(ej={})),function(e){e.ENABLED="enabled",e.DISABLED="disabled"}(eW||(eW={})),function(e){e.AMOUNT="amount",e.PRODUCTS_COUNT="productsCount",e.TRANSACTION_ID="transactionId"}(eK||(eK={})),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(eY||(eY={})),function(e){e.LOG="log",e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(eQ||(eQ={})),function(e){e.WEB="web",e.FULLSTACK="fullstack"}(e$||(e$={})),function(e){e.NO_DATA_FOUND="convert.com_no_data_found",e.NEED_MORE_DATA="convert.com_need_more_data"}(ez||(ez={})),function(e){e.READY="ready",e.CONFIG_UPDATED="config.updated",e.API_QUEUE_RELEASED="api.queue.released",e.BUCKETING="bucketing",e.CONVERSION="conversion",e.SEGMENTS="segments",e.LOCATION_ACTIVATED="location.activated",e.LOCATION_DEACTIVATED="location.deactivated",e.AUDIENCES="audiences",e.DATA_STORE_QUEUE_RELEASED="datastore.queue.released"}(eX||(eX={})),function(e){e.RICH_STRUCTURE="richStructure",e.CUSTOM_CODE="customCode",e.DEFAULT_CODE="defaultCode",e.DEFAULT_CODE_MULTIPAGE="defaultCodeMultipage",e.DEFAULT_REDIRECT="defaultRedirect",e.FULLSTACK_FEATURE="fullStackFeature"}(eJ||(eJ={})),function(e){e.IE="IE",e.CH="CH",e.FF="FF",e.OP="OP",e.SF="SF",e.EDG="EDG",e.MO="MO",e.NS="NS",e.OTH="OTH"}(eZ||(eZ={})),function(e){e.ALLPH="ALLPH",e.IPH="IPH",e.OTHPH="OTHPH",e.ALLTAB="ALLTAB",e.IPAD="IPAD",e.OTHTAB="OTHTAB",e.DESK="DESK",e.OTHDEV="OTHDEV"}(e0||(e0={})),function(e){e.COUNTRY="country",e.BROWSER="browser",e.DEVICES="devices",e.SOURCE="source",e.CAMPAIGN="campaign",e.VISITOR_TYPE="visitorType",e.CUSTOM_SEGMENTS="customSegments"}(e5||(e5={})),function(e){e.CAMPAIGN="campaign",e.SEARCH="search",e.REFERRAL="referral",e.DIRECT="direct"}(e1||(e1={})),function(e){e.NEW="new",e.RETURNING="returning"}(e4||(e4={})),function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.ImUsed=226]="ImUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.UriTooLong=414]="UriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RangeNotSatisfiable=416]="RangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired"}(e6||(e6={})),r={exports:{}},function(){let e=e=>new TextEncoder().encode(e);function t(t,i){let n,r,a,o,s,l;for("string"==typeof t&&(t=e(t)),n=3&t.length,r=t.length-n,a=i,l=0;l<r;)s=255&t[l]|(255&t[++l])<<8|(255&t[++l])<<16|(255&t[++l])<<24,++l,a^=s=(65535&(s=(s=(65535&s)*3432918353+(((s>>>16)*3432918353&65535)<<16)&4294967295)<<15|s>>>17))*461845907+(((s>>>16)*461845907&65535)<<16)&4294967295,a=(65535&(o=(65535&(a=a<<13|a>>>19))*5+(((a>>>16)*5&65535)<<16)&4294967295))+27492+(((o>>>16)+58964&65535)<<16);switch(s=0,n){case 3:s^=(255&t[l+2])<<16;case 2:s^=(255&t[l+1])<<8;case 1:s^=255&t[l],a^=s=(65535&(s=(s=(65535&s)*3432918353+(((s>>>16)*3432918353&65535)<<16)&4294967295)<<15|s>>>17))*461845907+(((s>>>16)*461845907&65535)<<16)&4294967295}return a^=t.length,a^=a>>>16,a=(65535&a)*2246822507+(((a>>>16)*2246822507&65535)<<16)&4294967295,a^=a>>>13,a=(65535&a)*3266489909+(((a>>>16)*3266489909&65535)<<16)&4294967295,(a^=a>>>16)>>>0}t.v2=function(t,i){"string"==typeof t&&(t=e(t));let n=t.length,r=i^n,a=0,o;for(;n>=4;)o=(65535&(o=255&t[a]|(255&t[++a])<<8|(255&t[++a])<<16|(255&t[++a])<<24))*1540483477+(((o>>>16)*1540483477&65535)<<16),o^=o>>>24,r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16)^(o=(65535&o)*1540483477+(((o>>>16)*1540483477&65535)<<16)),n-=4,++a;switch(n){case 3:r^=(255&t[a+2])<<16;case 2:r^=(255&t[a+1])<<8;case 1:r^=255&t[a],r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16)}return r^=r>>>13,r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16),(r^=r>>>15)>>>0},t.v3=t,r.exports=t}();class nw{constructor(e,t,{eventManager:i,experienceManager:n,featureManager:r,segmentsManager:a,dataManager:o,apiManager:s,loggerManager:l},u){if(this._environment=null==e?void 0:e.environment,this._visitorId=t,this._config=e,this._eventManager=i,this._experienceManager=n,this._featureManager=r,this._dataManager=o,this._segmentsManager=a,this._apiManager=s,this._loggerManager=l,nb(u)){let{properties:e}=this._dataManager.filterReportSegments(u);e&&(this._visitorProperties=e),a.putSegments(t,u)}}runExperience(e,t){var i,n;if(!this._visitorId){null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.error)||void 0===n||n.call(i,"Context.runExperience()",ny.VISITOR_ID_REQUIRED);return}let r=this.getVisitorProperties(null==t?void 0:t.visitorProperties),a=this._experienceManager.selectVariation(this._visitorId,e,{visitorProperties:r,locationProperties:null==t?void 0:t.locationProperties,updateVisitorProperties:null==t?void 0:t.updateVisitorProperties,environment:(null==t?void 0:t.environment)||this._environment});return Object.values(eF).includes(a)||Object.values(eC).includes(a)||a&&this._eventManager.fire(eP.BUCKETING,{visitorId:this._visitorId,experienceKey:e,variationKey:a.key},null,!0),a}runExperiences(e){var t,i;if(!this._visitorId){null===(i=null===(t=this._loggerManager)||void 0===t?void 0:t.error)||void 0===i||i.call(t,"Context.runExperiences()",ny.VISITOR_ID_REQUIRED);return}let n=this.getVisitorProperties(null==e?void 0:e.visitorProperties),r=this._experienceManager.selectVariations(this._visitorId,{visitorProperties:n,locationProperties:null==e?void 0:e.locationProperties,updateVisitorProperties:null==e?void 0:e.updateVisitorProperties,environment:(null==e?void 0:e.environment)||this._environment}),a=r.filter(e=>Object.values(eF).includes(e));if(a.length)return a;let o=r.filter(e=>Object.values(eC).includes(e));return o.length?o:(r.forEach(({experienceKey:e,key:t})=>{this._eventManager.fire(eP.BUCKETING,{visitorId:this._visitorId,experienceKey:e,variationKey:t},null,!0)}),r)}runFeature(e,t){var i,n;if(!this._visitorId){null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.error)||void 0===n||n.call(i,"Context.runFeature()",ny.VISITOR_ID_REQUIRED);return}let r=this.getVisitorProperties(null==t?void 0:t.visitorProperties),a=this._featureManager.runFeature(this._visitorId,e,{visitorProperties:r,locationProperties:null==t?void 0:t.locationProperties,updateVisitorProperties:null==t?void 0:t.updateVisitorProperties,typeCasting:!Object.prototype.hasOwnProperty.call(t||{},"typeCasting")||t.typeCasting,environment:(null==t?void 0:t.environment)||this._environment},null==t?void 0:t.experienceKeys);if(Array.isArray(a)){let t=a.filter(e=>Object.values(eF).includes(e));if(t.length)return t;a.forEach(({experienceKey:t,status:i})=>{this._eventManager.fire(eP.BUCKETING,{visitorId:this._visitorId,experienceKey:t,featureKey:e,status:i},null,!0)})}else{if(Object.values(eF).includes(a))return a;a&&this._eventManager.fire(eP.BUCKETING,{visitorId:this._visitorId,experienceKey:a.experienceKey,featureKey:e,status:a.status},null,!0)}return a}runFeatures(e){var t,i;if(!this._visitorId){null===(i=null===(t=this._loggerManager)||void 0===t?void 0:t.error)||void 0===i||i.call(t,"Context.runFeatures()",ny.VISITOR_ID_REQUIRED);return}let n=this.getVisitorProperties(null==e?void 0:e.visitorProperties),r=this._featureManager.runFeatures(this._visitorId,{visitorProperties:n,locationProperties:null==e?void 0:e.locationProperties,updateVisitorProperties:null==e?void 0:e.updateVisitorProperties,typeCasting:!Object.prototype.hasOwnProperty.call(e||{},"typeCasting")||e.typeCasting,environment:(null==e?void 0:e.environment)||this._environment}),a=r.filter(e=>Object.values(eF).includes(e));return a.length?a:(r.forEach(({experienceKey:e,key:t,status:i})=>{this._eventManager.fire(eP.BUCKETING,{visitorId:this._visitorId,experienceKey:e,featureKey:t,status:i},null,!0)}),r)}trackConversion(e,t){var i,n,r,a;if(!this._visitorId){null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.error)||void 0===n||n.call(i,"Context.trackConversion()",ny.VISITOR_ID_REQUIRED);return}let o=null==t?void 0:t.ruleData,s=null==t?void 0:t.conversionData;if(s&&!Array.isArray(s)){null===(a=null===(r=this._loggerManager)||void 0===r?void 0:r.error)||void 0===a||a.call(r,"Context.trackConversion()",ny.GOAL_DATA_NOT_VALID);return}let l=this._segmentsManager.getSegments(this._visitorId),u=this._dataManager.convert(this._visitorId,e,o,s,l,null==t?void 0:t.conversionSetting);if(Object.values(eF).includes(u))return u;u&&this._eventManager.fire(eP.CONVERSION,{visitorId:this._visitorId,goalKey:e},null,!0)}setDefaultSegments(e){this._segmentsManager.putSegments(this._visitorId,e)}setCustomSegments(e,t){return this.runCustomSegments(e,t)}runCustomSegments(e,t){var i,n;if(!this._visitorId){null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.error)||void 0===n||n.call(i,"Context.runCustomSegments()",ny.VISITOR_ID_REQUIRED);return}let r=this.getVisitorProperties(null==t?void 0:t.ruleData),a=this._segmentsManager.selectCustomSegments(this._visitorId,e,r);if(a)return a}updateVisitorProperties(e,t){this._dataManager.putData(e,{segments:t})}getConfigEntity(e,t){if(t===eD.VARIATION)for(let{key:t}of this._dataManager.getEntitiesList(eD.EXPERIENCE)){let i=this._dataManager.getSubItem("experiences",t,"variations",e,"key","key");if(i)return i}return this._dataManager.getEntity(e,t)}getConfigEntityById(e,t){if(t===eD.VARIATION)for(let{id:t}of this._dataManager.getEntitiesList(eD.EXPERIENCE)){let i=this._dataManager.getSubItem("experiences",t,"variations",e,"id","id");if(i)return i}return this._dataManager.getEntityById(e,t)}getVisitorData(){return this._dataManager.getData(this._visitorId)||{}}releaseQueues(e){return this._dataManager.dataStoreManager&&this._dataManager.dataStoreManager.releaseQueue(e),this._apiManager.releaseQueue(e)}getVisitorProperties(e){let{segments:t}=this._dataManager.getData(this._visitorId)||{},i=e?nP(this._visitorProperties||{},e):this._visitorProperties;return nP(t||{},i||{})}}class nH{constructor(e,{dataManager:t,eventManager:i,experienceManager:n,featureManager:r,segmentsManager:a,apiManager:o,loggerManager:s}){var l,u;this._initialized=!1,this._environment=null==e?void 0:e.environment,this._dataManager=t,this._eventManager=i,this._experienceManager=n,this._featureManager=r,this._loggerManager=s,this._segmentsManager=a,this._dataManager=t,this._eventManager=i,this._apiManager=o,this._loggerManager=s,null===(u=null===(l=this._loggerManager)||void 0===l?void 0:l.trace)||void 0===u||u.call(l,"Core()",nM.CORE_CONSTRUCTOR,this),this.initialize(e)}initialize(e){var t,i,n,r,a,o,s;e&&(this._config=e,Object.prototype.hasOwnProperty.call(e,"sdkKey")&&(null===(t=e.sdkKey)||void 0===t?void 0:t.length)?this.fetchConfig():Object.prototype.hasOwnProperty.call(e,"data")?(this._dataManager.data=e.data,e.data.error?null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.error)||void 0===n||n.call(i,"Core.initialize()",{error:e.data.error}):(this._eventManager.fire(eP.READY,null,null,!0),null===(a=null===(r=this._loggerManager)||void 0===r?void 0:r.trace)||void 0===a||a.call(r,"Core.initialize()",nM.CORE_INITIALIZED),this._initialized=!0)):(null===(s=null===(o=this._loggerManager)||void 0===o?void 0:o.error)||void 0===s||s.call(o,"Core.initialize()",ny.SDK_OR_DATA_OBJECT_REQUIRED),this._eventManager.fire(eP.READY,{},Error(ny.SDK_OR_DATA_OBJECT_REQUIRED),!0)))}createContext(e,t){return this._initialized?new nw(this._config,e,{eventManager:this._eventManager,experienceManager:this._experienceManager,featureManager:this._featureManager,segmentsManager:this._segmentsManager,apiManager:this._apiManager,dataManager:this._dataManager,loggerManager:this._loggerManager},t):null}on(e,t){this._eventManager.on(e,t)}onReady(){return nm(this,void 0,void 0,function*(){return yield this._promise,new Promise((e,t)=>{nb(this._dataManager.data)?e():t(Error(ny.DATA_OBJECT_MISSING))})})}fetchConfig(){return nm(this,void 0,void 0,function*(){var e,t,i,n,r,a,o,s,l,u,d;this._promise=this._apiManager.getConfig();try{let u=yield this._promise;u.error?(this._dataManager.data=u,null===(t=null===(e=this._loggerManager)||void 0===e?void 0:e.error)||void 0===t||t.call(e,"Core.fetchConfig()",{error:u.error})):(null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.trace)||void 0===n||n.call(i,"Core.fetchConfig()",{data:u}),this._eventManager.fire(nb(this._dataManager.data)?eP.CONFIG_UPDATED:eP.READY,null,null,!0),nb(this._dataManager.data)?null===(a=null===(r=this._loggerManager)||void 0===r?void 0:r.trace)||void 0===a||a.call(r,"Core.fetchConfig()",nM.CONFIG_DATA_UPDATED):(null===(s=null===(o=this._loggerManager)||void 0===o?void 0:o.trace)||void 0===s||s.call(o,"Core.fetchConfig()",nM.CORE_INITIALIZED),this._initialized=!0),this._dataManager.data=u,this._apiManager.setData(u)),this._fetchConfigTimerID&&clearTimeout(this._fetchConfigTimerID),this._fetchConfigTimerID=setTimeout(()=>this.fetchConfig(),(null===(l=this._config)||void 0===l?void 0:l.dataRefreshInterval)||3e5)}catch(e){null===(d=null===(u=this._loggerManager)||void 0===u?void 0:u.error)||void 0===d||d.call(u,"Core.fetchConfig()",{error:e.message})}})}}function nB(e){return Array.isArray(e)&&e.length>0}function nG(e,t,i,n=!1){try{if("object"==typeof e){let i=t.split(".").reduce((e,t)=>e[t],e);if(i||n&&(!1===i||0===i))return i}}catch(e){}return null}function nx(...e){let t=e=>e&&"object"==typeof e;return e.reduce((e,i)=>(Object.keys(i).forEach(n=>{let r=e[n],a=i[n];Array.isArray(r)&&Array.isArray(a)?e[n]=[...new Set([...a,...r])]:t(r)&&t(a)?e[n]=nx(r,a):e[n]=a}),e),{})}function nV(e){return"object"==typeof e&&null!==e&&Object.keys(e).length>0}"function"==typeof SuppressedError&&SuppressedError;let nq=(e,t)=>{if(e===t)return!0;if("object"!=typeof e||"object"!=typeof t||null==e||null==t)return!1;let i=Object.keys(e),n=Object.keys(t);if(i.length!=n.length)return!1;for(let r of i){if(!n.includes(r))return!1;if("function"==typeof e[r]||"function"==typeof t[r]){if(e[r].toString()!=t[r].toString())return!1}else if(!nq(e[r],t[r]))return!1}return!0},nj=class{static equals(e,t,i){return Array.isArray(e)?this._returnNegationCheck(-1!==e.indexOf(t),i):nV(e)?this._returnNegationCheck(-1!==Object.keys(e).indexOf(String(t)),i):(e=String(e),t=String(t),e=e.valueOf().toLowerCase(),t=t.valueOf().toLowerCase(),this._returnNegationCheck(e===t,i))}static less(e,t,i){return typeof e==typeof t&&this._returnNegationCheck(e<t,i)}static lessEqual(e,t,i){return typeof e==typeof t&&this._returnNegationCheck(e<=t,i)}static contains(e,t,i){return(e=String(e),t=String(t),e=e.valueOf().toLowerCase(),0===(t=t.valueOf().toLowerCase()).replace(/^([\s]*)|([\s]*)$/g,"").length)?this._returnNegationCheck(!0,i):this._returnNegationCheck(-1!==e.indexOf(t),i)}static isIn(e,t,i=!1,n="|"){let r=String(e).split(n).map(e=>String(e));"string"==typeof t&&(t=t.split(n)),Array.isArray(t)||(t=[]),t=t.map(e=>String(e).valueOf().toLowerCase());for(let e=0;e<r.length;e++)if(-1!==t.indexOf(r[e]))return this._returnNegationCheck(!0,i);return this._returnNegationCheck(!1,i)}static startsWith(e,t,i){return e=String(e).valueOf().toLowerCase(),t=String(t).valueOf().toLowerCase(),this._returnNegationCheck(0===e.indexOf(t),i)}static endsWith(e,t,i){return e=String(e).valueOf().toLowerCase(),t=String(t).valueOf().toLowerCase(),this._returnNegationCheck(-1!==e.indexOf(t,e.length-t.length),i)}static regexMatches(e,t,i){e=String(e).valueOf().toLowerCase();let n=RegExp(t=String(t).valueOf(),"i");return this._returnNegationCheck(n.test(e),i)}static _returnNegationCheck(e,t=!1){return t?!e:e}};nj.equalsNumber=nj.equals,nj.matches=nj.equals,"function"==typeof SuppressedError&&SuppressedError,(e3||(e3={})).VARIAION_NOT_DECIDED="convert.com_variation_not_decided",(e2||(e2={})).FORCE_MULTIPLE_TRANSACTIONS="forceMultipleTransactions",function(e){e.OFF="OFF",e.EU_ONLY="EU ONLY",e.EEA_ONLY="EEA ONLY",e.WORLDWIDE="Worldwide"}(e9||(e9={})),function(e){e.AUDIENCE="audience",e.LOCATION="location",e.SEGMENT="segment",e.FEATURE="feature",e.GOAL="goal",e.EXPERIENCE="experience",e.VARIATION="variation"}(e7||(e7={})),function(e){e.ENABLED="enabled",e.DISABLED="disabled"}(e8||(e8={})),function(e){e.AMOUNT="amount",e.PRODUCTS_COUNT="productsCount",e.TRANSACTION_ID="transactionId"}(te||(te={})),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(tt||(tt={})),function(e){e.LOG="log",e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(ti||(ti={})),function(e){e.WEB="web",e.FULLSTACK="fullstack"}(tn||(tn={})),function(e){e.NO_DATA_FOUND="convert.com_no_data_found",e.NEED_MORE_DATA="convert.com_need_more_data"}(tr||(tr={})),function(e){e.READY="ready",e.CONFIG_UPDATED="config.updated",e.API_QUEUE_RELEASED="api.queue.released",e.BUCKETING="bucketing",e.CONVERSION="conversion",e.SEGMENTS="segments",e.LOCATION_ACTIVATED="location.activated",e.LOCATION_DEACTIVATED="location.deactivated",e.AUDIENCES="audiences",e.DATA_STORE_QUEUE_RELEASED="datastore.queue.released"}(ta||(ta={})),function(e){e.RICH_STRUCTURE="richStructure",e.CUSTOM_CODE="customCode",e.DEFAULT_CODE="defaultCode",e.DEFAULT_CODE_MULTIPAGE="defaultCodeMultipage",e.DEFAULT_REDIRECT="defaultRedirect",e.FULLSTACK_FEATURE="fullStackFeature"}(to||(to={})),function(e){e.IE="IE",e.CH="CH",e.FF="FF",e.OP="OP",e.SF="SF",e.EDG="EDG",e.MO="MO",e.NS="NS",e.OTH="OTH"}(ts||(ts={})),function(e){e.ALLPH="ALLPH",e.IPH="IPH",e.OTHPH="OTHPH",e.ALLTAB="ALLTAB",e.IPAD="IPAD",e.OTHTAB="OTHTAB",e.DESK="DESK",e.OTHDEV="OTHDEV"}(tl||(tl={})),function(e){e.COUNTRY="country",e.BROWSER="browser",e.DEVICES="devices",e.SOURCE="source",e.CAMPAIGN="campaign",e.VISITOR_TYPE="visitorType",e.CUSTOM_SEGMENTS="customSegments"}(tu||(tu={})),function(e){e.CAMPAIGN="campaign",e.SEARCH="search",e.REFERRAL="referral",e.DIRECT="direct"}(td||(td={})),function(e){e.NEW="new",e.RETURNING="returning"}(tc||(tc={})),function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.ImUsed=226]="ImUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.UriTooLong=414]="UriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RangeNotSatisfiable=416]="RangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired"}(tE||(tE={})),a={exports:{}},function(){let e=e=>new TextEncoder().encode(e);function t(t,i){let n,r,a,o,s,l;for("string"==typeof t&&(t=e(t)),n=3&t.length,r=t.length-n,a=i,l=0;l<r;)s=255&t[l]|(255&t[++l])<<8|(255&t[++l])<<16|(255&t[++l])<<24,++l,a^=s=(65535&(s=(s=(65535&s)*3432918353+(((s>>>16)*3432918353&65535)<<16)&4294967295)<<15|s>>>17))*461845907+(((s>>>16)*461845907&65535)<<16)&4294967295,a=(65535&(o=(65535&(a=a<<13|a>>>19))*5+(((a>>>16)*5&65535)<<16)&4294967295))+27492+(((o>>>16)+58964&65535)<<16);switch(s=0,n){case 3:s^=(255&t[l+2])<<16;case 2:s^=(255&t[l+1])<<8;case 1:s^=255&t[l],a^=s=(65535&(s=(s=(65535&s)*3432918353+(((s>>>16)*3432918353&65535)<<16)&4294967295)<<15|s>>>17))*461845907+(((s>>>16)*461845907&65535)<<16)&4294967295}return a^=t.length,a^=a>>>16,a=(65535&a)*2246822507+(((a>>>16)*2246822507&65535)<<16)&4294967295,a^=a>>>13,a=(65535&a)*3266489909+(((a>>>16)*3266489909&65535)<<16)&4294967295,(a^=a>>>16)>>>0}t.v2=function(t,i){"string"==typeof t&&(t=e(t));let n=t.length,r=i^n,a=0,o;for(;n>=4;)o=(65535&(o=255&t[a]|(255&t[++a])<<8|(255&t[++a])<<16|(255&t[++a])<<24))*1540483477+(((o>>>16)*1540483477&65535)<<16),o^=o>>>24,r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16)^(o=(65535&o)*1540483477+(((o>>>16)*1540483477&65535)<<16)),n-=4,++a;switch(n){case 3:r^=(255&t[a+2])<<16;case 2:r^=(255&t[a+1])<<8;case 1:r^=255&t[a],r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16)}return r^=r>>>13,r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16),(r^=r>>>15)>>>0},t.v3=t,a.exports=t}();let nW={PERMANENT:"permanent"},nK={RUNNING:"running"},nY={BUCKETING:"bucketing",CONVERSION:"conversion"};(tg||(tg={})).VARIAION_NOT_DECIDED="convert.com_variation_not_decided",(t_||(t_={})).FORCE_MULTIPLE_TRANSACTIONS="forceMultipleTransactions";let nQ=["events","goals","audiences","locations","segments","experiences","archived_experiences","experiences.variations","features","features.variables"],n$={goal:"goals",audience:"audiences",location:"locations",segment:"segments",experience:"experiences",variation:"experiences.variations",feature:"features"},nz={CONFIG_DATA_NOT_VALID:"Config Data is not valid",DATA_STORE_NOT_VALID:"DataStore object is not valid. It should contain get and set methods",UNABLE_TO_SELECT_BUCKET_FOR_VISITOR:"Unable to bucket visitor"},nX={EXPERIENCE_NOT_FOUND:"Experience not found",EXPERIENCE_RULES_MATCHED:"Experience rules matched",VARIATIONS_NOT_FOUND:"Variations not found",DATA_CONSTRUCTOR:"Data Manager constructor has been called",LOCATION_MATCH:"Location # rule matched",LOCATION_NOT_MATCH:"Location does not match",LOCATION_NOT_RESTRICTED:"Location not restricted",AUDIENCE_MATCH:"Audience # rule matched",AUDIENCE_NOT_MATCH:"Audience does not match",NON_PERMANENT_AUDIENCE_NOT_RESTRICTED:"Non-Permanent Audience not restricted",AUDIENCE_NOT_RESTRICTED:"Audience not restricted",SEGMENTATION_MATCH:"Segmentation # rule matched",SEGMENTATION_NOT_RESTRICTED:"Segmentation not restricted",LOCATION_ACTIVATED:"Location # activated",LOCATION_DEACTIVATED:"Location # deactivated",BUCKETED_VISITOR_FOUND:"Visitor is already bucketed for variation #",BUCKETED_VISITOR_FORCED:"Forcing variation #",BUCKETED_VISITOR:"Visitor is bucketed for variation #",GOAL_NOT_FOUND:"Goal not found",GOAL_RULE_NOT_MATCH:"Goal rule do not match",GOAL_FOUND:"Goal # already triggered"};(function(e){e.OFF="OFF",e.EU_ONLY="EU ONLY",e.EEA_ONLY="EEA ONLY",e.WORLDWIDE="Worldwide"})(th||(th={})),function(e){e.AUDIENCE="audience",e.LOCATION="location",e.SEGMENT="segment",e.FEATURE="feature",e.GOAL="goal",e.EXPERIENCE="experience",e.VARIATION="variation"}(tO||(tO={})),function(e){e.ENABLED="enabled",e.DISABLED="disabled"}(tT||(tT={})),function(e){e.AMOUNT="amount",e.PRODUCTS_COUNT="productsCount",e.TRANSACTION_ID="transactionId"}(tv||(tv={})),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(tA||(tA={})),function(e){e.LOG="log",e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(tf||(tf={})),function(e){e.WEB="web",e.FULLSTACK="fullstack"}(tR||(tR={})),function(e){e.NO_DATA_FOUND="convert.com_no_data_found",e.NEED_MORE_DATA="convert.com_need_more_data"}(tp||(tp={})),function(e){e.READY="ready",e.CONFIG_UPDATED="config.updated",e.API_QUEUE_RELEASED="api.queue.released",e.BUCKETING="bucketing",e.CONVERSION="conversion",e.SEGMENTS="segments",e.LOCATION_ACTIVATED="location.activated",e.LOCATION_DEACTIVATED="location.deactivated",e.AUDIENCES="audiences",e.DATA_STORE_QUEUE_RELEASED="datastore.queue.released"}(tN||(tN={})),function(e){e.RICH_STRUCTURE="richStructure",e.CUSTOM_CODE="customCode",e.DEFAULT_CODE="defaultCode",e.DEFAULT_CODE_MULTIPAGE="defaultCodeMultipage",e.DEFAULT_REDIRECT="defaultRedirect",e.FULLSTACK_FEATURE="fullStackFeature"}(tC||(tC={})),function(e){e.IE="IE",e.CH="CH",e.FF="FF",e.OP="OP",e.SF="SF",e.EDG="EDG",e.MO="MO",e.NS="NS",e.OTH="OTH"}(tI||(tI={})),function(e){e.ALLPH="ALLPH",e.IPH="IPH",e.OTHPH="OTHPH",e.ALLTAB="ALLTAB",e.IPAD="IPAD",e.OTHTAB="OTHTAB",e.DESK="DESK",e.OTHDEV="OTHDEV"}(tS||(tS={})),function(e){e.COUNTRY="country",e.BROWSER="browser",e.DEVICES="devices",e.SOURCE="source",e.CAMPAIGN="campaign",e.VISITOR_TYPE="visitorType",e.CUSTOM_SEGMENTS="customSegments"}(tD||(tD={})),function(e){e.CAMPAIGN="campaign",e.SEARCH="search",e.REFERRAL="referral",e.DIRECT="direct"}(tL||(tL={})),function(e){e.NEW="new",e.RETURNING="returning"}(tU||(tU={}));class nJ{constructor(e,{dataStore:t,eventManager:i,loggerManager:n}={}){var r,a;this.batchSize=1,this.releaseInterval=5e3,this._loggerManager=n,this._eventManager=i,this.batchSize=Number(null===(r=null==e?void 0:e.events)||void 0===r?void 0:r.batch_size)||1,this.releaseInterval=Number(null===(a=null==e?void 0:e.events)||void 0===a?void 0:a.release_interval)||5e3,this.dataStore=t,this._mapper=(null==e?void 0:e.mapper)||(e=>e),this._requestsQueue={}}set(e,t){var i,n,r,a;try{null===(n=null===(i=this.dataStore)||void 0===i?void 0:i.set)||void 0===n||n.call(i,e,t)}catch(e){null===(a=null===(r=this._loggerManager)||void 0===r?void 0:r.error)||void 0===a||a.call(r,"DataStoreManager.set()",{error:e.message})}}get(e){var t,i,n,r;try{return null===(i=null===(t=this.dataStore)||void 0===t?void 0:t.get)||void 0===i?void 0:i.call(t,e)}catch(e){null===(r=null===(n=this._loggerManager)||void 0===n?void 0:n.error)||void 0===r||r.call(n,"DataStoreManager.get()",{error:e.message})}return null}enqueue(e,t){var i,n;null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.trace)||void 0===n||n.call(i,"DataStoreManager.enqueue()",this._mapper({key:e,data:t}));let r={};r[e]=t,this._requestsQueue=nx(this._requestsQueue,r),Object.keys(this._requestsQueue).length>=this.batchSize?this.releaseQueue("size"):1===Object.keys(this._requestsQueue).length&&this.startQueue()}releaseQueue(e){var t,i,n,r;for(let n in null===(i=null===(t=this._loggerManager)||void 0===t?void 0:t.info)||void 0===i||i.call(t,"DataStoreManager.releaseQueue()",{reason:e||""}),this.stopQueue(),this._requestsQueue)this.set(n,this._requestsQueue[n]);null===(r=null===(n=this._eventManager)||void 0===n?void 0:n.fire)||void 0===r||r.call(n,tN.DATA_STORE_QUEUE_RELEASED,{reason:e||""})}stopQueue(){clearTimeout(this._requestsQueueTimerID)}startQueue(){this._requestsQueueTimerID=setTimeout(()=>{this.releaseQueue("timeout")},this.releaseInterval)}set dataStore(e){var t,i;e&&(this.isValidDataStore(e)?this._dataStore=e:null===(i=null===(t=this._loggerManager)||void 0===t?void 0:t.error)||void 0===i||i.call(t,"DataStoreManager.dataStore.set()",nz.DATA_STORE_NOT_VALID))}get dataStore(){return this._dataStore}isValidDataStore(e){return"object"==typeof e&&"function"==typeof e.get&&"function"==typeof e.set}}class nZ{constructor(e,{bucketingManager:t,ruleManager:i,eventManager:n,apiManager:r,loggerManager:a},{asyncStorage:o=!0}={}){var s,l,u,d,c;this._dataEntities=nQ,this._localStoreLimit=1e4,this._bucketedVisitors=new Map,this._environment=null==e?void 0:e.environment,this._apiManager=r,this._bucketingManager=t,this._ruleManager=i,this._loggerManager=a,this._eventManager=n,this._config=e,this._mapper=(null==e?void 0:e.mapper)||(e=>e),this._asyncStorage=o,this._data=nG(e,"data"),this._accountId=null===(s=this._data)||void 0===s?void 0:s.account_id,this._projectId=null===(u=null===(l=this._data)||void 0===l?void 0:l.project)||void 0===u?void 0:u.id,this.dataStoreManager=null==e?void 0:e.dataStore,null===(c=null===(d=this._loggerManager)||void 0===d?void 0:d.trace)||void 0===c||c.call(d,"DataManager()",nX.DATA_CONSTRUCTOR,this)}set data(e){var t,i,n;this.isValidConfigData(e)?(this._data=e,this._accountId=null==e?void 0:e.account_id,this._projectId=null===(t=null==e?void 0:e.project)||void 0===t?void 0:t.id):null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.error)||void 0===n||n.call(i,"DataManager.data.set()",nz.CONFIG_DATA_NOT_VALID)}get data(){return this._data}set dataStoreManager(e){this._dataStoreManager=null,e&&(this._dataStoreManager=new nJ(this._config,{dataStore:e,eventManager:this._eventManager,loggerManager:this._loggerManager}))}get dataStoreManager(){return this._dataStoreManager}setDataStore(e){this._dataStoreManager=null,e&&(this._dataStoreManager=new nJ(this._config,{dataStore:e,eventManager:this._eventManager,loggerManager:this._loggerManager}))}matchRulesByField(e,t,i="key",n){var r,a,o,s,l,u,d,c,E,g,_,h,O,T,v,A,f,R,p,N,C,I,S,D,L;let{visitorProperties:U,locationProperties:m,ignoreLocationProperties:y,environment:M=this._environment}=n;null===(a=null===(r=this._loggerManager)||void 0===r?void 0:r.trace)||void 0===a||a.call(r,"DataManager.matchRulesByField()",this._mapper({visitorId:e,identity:t,identityField:i,visitorProperties:U,locationProperties:m,ignoreLocationProperties:y,environment:M}));let F=this._getEntityByField(t,"experiences",i),P=!!this.getEntitiesList("archived_experiences").find(e=>String(null==F?void 0:F.id)===String(e)),b=null==F||!F.environment||F.environment===M,k=[];if(F&&!P&&b){let{bucketing:t}=this.getData(e)||{},{[F.id.toString()]:n}=t||{},r=!1;n&&this.retrieveVariation(F.id,String(n))&&(r=!0);let a=!0===y;if(!a&&m){if(Array.isArray(null==F?void 0:F.locations)&&F.locations.length){let t=[],n=this.getItemsByIds(F.locations,"locations");if(n.length&&(k=(t=this.selectLocations(e,n,{locationProperties:m,identityField:i})).filter(e=>Object.values(tp).includes(e))).length)return k[0];a=!!t.length}else if(null==F?void 0:F.site_area){if(a=this._ruleManager.isRuleMatched(m,F.site_area,"SiteArea"),Object.values(tp).includes(a))return a}else a=!0,null===(s=null===(o=this._loggerManager)||void 0===o?void 0:o.info)||void 0===s||s.call(o,"DataManager.matchRulesByField()",nX.LOCATION_NOT_RESTRICTED)}if(!a)return null===(u=null===(l=this._loggerManager)||void 0===l?void 0:l.debug)||void 0===u||u.call(l,"DataManager.matchRulesByField()",nX.LOCATION_NOT_MATCH,this._mapper({locationProperties:m,[(null==F?void 0:F.locations)?"experiences[].variations[].locations":"experiences[].variations[].site_area"]:(null==F?void 0:F.locations)||(null==F?void 0:F.site_area)||""})),null;let D=[],L=[],M=[],P=[],b=[],w=!1,H=!1;if(U){if(Array.isArray(null==F?void 0:F.audiences)&&F.audiences.length){if((b=(D=this.getItemsByIds(F.audiences,"audiences")).filter(e=>!(r&&e.type===nW.PERMANENT))).length){if((k=(M=this.filterMatchedRecordsWithRule(b,U,"audience",i)).filter(e=>Object.values(tp).includes(e))).length)return k[0];if(M.length)for(let e of M)null===(c=null===(d=this._loggerManager)||void 0===d?void 0:d.info)||void 0===c||c.call(d,"DataManager.matchRulesByField()",nX.AUDIENCE_MATCH.replace("#",null==e?void 0:e[i]));w=!!M.length}else w=!0,null===(g=null===(E=this._loggerManager)||void 0===E?void 0:E.info)||void 0===g||g.call(E,"DataManager.matchRulesByField()",nX.NON_PERMANENT_AUDIENCE_NOT_RESTRICTED)}else w=!0,null===(h=null===(_=this._loggerManager)||void 0===_?void 0:_.info)||void 0===h||h.call(_,"DataManager.matchRulesByField()",nX.AUDIENCE_NOT_RESTRICTED)}if((L=this.getItemsByIds(F.audiences,"segments")).length){if((P=this.filterMatchedCustomSegments(L,e)).length)for(let e of P)null===(T=null===(O=this._loggerManager)||void 0===O?void 0:O.info)||void 0===T||T.call(O,"DataManager.matchRulesByField()",nX.SEGMENTATION_MATCH.replace("#",null==e?void 0:e[i]));H=!!P.length}else H=!0,null===(A=null===(v=this._loggerManager)||void 0===v?void 0:v.info)||void 0===A||A.call(v,"DataManager.matchRulesByField()",nX.SEGMENTATION_NOT_RESTRICTED);if(w&&H){if((null==F?void 0:F.variations)&&(null===(f=null==F?void 0:F.variations)||void 0===f?void 0:f.length))return null===(p=null===(R=this._loggerManager)||void 0===R?void 0:R.info)||void 0===p||p.call(R,"DataManager.matchRulesByField()",nX.EXPERIENCE_RULES_MATCHED),F;null===(C=null===(N=this._loggerManager)||void 0===N?void 0:N.debug)||void 0===C||C.call(N,"DataManager.matchRulesByField()",nX.VARIATIONS_NOT_FOUND,this._mapper({visitorProperties:U,audiences:D}))}else null===(S=null===(I=this._loggerManager)||void 0===I?void 0:I.debug)||void 0===S||S.call(I,"DataManager.matchRulesByField()",nX.AUDIENCE_NOT_MATCH,this._mapper({visitorProperties:U,audiences:D}))}else null===(L=null===(D=this._loggerManager)||void 0===D?void 0:D.debug)||void 0===L||L.call(D,"DataManager.matchRulesByField()",nX.EXPERIENCE_NOT_FOUND,this._mapper({identity:t,identityField:i}));return null}_getBucketingByField(e,t,i="key",n){var r,a;let{visitorProperties:o,locationProperties:s,updateVisitorProperties:l,forceVariationId:u,enableTracking:d=!0,ignoreLocationProperties:c,environment:E=this._environment}=n;null===(a=null===(r=this._loggerManager)||void 0===r?void 0:r.trace)||void 0===a||a.call(r,"DataManager._getBucketingByField()",this._mapper({visitorId:e,identity:t,identityField:i,visitorProperties:o,locationProperties:s,forceVariationId:u,enableTracking:d,ignoreLocationProperties:c,environment:E}));let g=this.matchRulesByField(e,t,i,{visitorProperties:o,locationProperties:s,ignoreLocationProperties:c,environment:E});return g?Object.values(tp).includes(g)?g:this._retrieveBucketing(e,o,l,g,u,d):null}_retrieveBucketing(e,t,i,n,r,a=!0){var o,s,l,u,d,c,E,g,_,h,O,T,v,A,f,R;if(!e||!n||!(null==n?void 0:n.id))return null;let p=null,N,C=null,I,S=this.getStoreKey(e);r&&(p=this.retrieveVariation(n.id,String(r)))&&(N=r,null===(s=null===(o=this._loggerManager)||void 0===o?void 0:o.info)||void 0===s||s.call(o,"DataManager._retrieveBucketing()",nX.BUCKETED_VISITOR_FORCED.replace("#",`#${r}`)),null===(u=null===(l=this._loggerManager)||void 0===l?void 0:l.debug)||void 0===u||u.call(l,"DataManager._retrieveBucketing()",this._mapper({storeKey:S,visitorId:e,variationId:r})));let{bucketing:D,segments:L}=this.getData(e)||{},{[n.id.toString()]:U}=D||{};if(U&&(!N||String(N)===String(U))&&(p=this.retrieveVariation(n.id,String(U))))N=U,null===(c=null===(d=this._loggerManager)||void 0===d?void 0:d.info)||void 0===c||c.call(d,"DataManager._retrieveBucketing()",nX.BUCKETED_VISITOR_FOUND.replace("#",`#${N}`)),null===(g=null===(E=this._loggerManager)||void 0===E?void 0:E.debug)||void 0===g||g.call(E,"DataManager._retrieveBucketing()",this._mapper({storeKey:S,visitorId:e,variationId:N}));else{let r=n.variations.filter(e=>null==e||!e.status||e.status===nK.RUNNING).reduce((e,t)=>((null==t?void 0:t.id)&&(e[t.id]=(null==t?void 0:t.traffic_allocation)||100),e),{}),o=this._bucketingManager.getBucketForVisitor(r,e,(null===(h=null===(_=this._config)||void 0===_?void 0:_.bucketing)||void 0===h?void 0:h.excludeExperienceIdHash)?null:{experienceId:n.id.toString()});if(N=N||(null==o?void 0:o.variationId),I=null==o?void 0:o.bucketingAllocation,!N)return null===(T=null===(O=this._loggerManager)||void 0===O?void 0:O.debug)||void 0===T||T.call(O,"DataManager._retrieveBucketing()",nz.UNABLE_TO_SELECT_BUCKET_FOR_VISITOR,this._mapper({visitorId:e,experience:n,buckets:r,bucketing:o})),tg.VARIAION_NOT_DECIDED;if(null===(A=null===(v=this._loggerManager)||void 0===v?void 0:v.info)||void 0===A||A.call(v,"DataManager._retrieveBucketing()",nX.BUCKETED_VISITOR.replace("#",`#${N}`)),i?this.putData(e,Object.assign({bucketing:{[n.id.toString()]:N}},t?{segments:t}:{})):this.putData(e,{bucketing:{[n.id.toString()]:N}}),a){let t={experienceId:n.id.toString(),variationId:N.toString()},i={eventType:nY.BUCKETING,data:t};this._apiManager.enqueue(e,i,L),null===(R=null===(f=this._loggerManager)||void 0===f?void 0:f.trace)||void 0===R||R.call(f,"DataManager._retrieveBucketing()",this._mapper({visitorEvent:i}))}p=this.retrieveVariation(n.id,String(N))}return p&&(C=Object.assign(Object.assign({experienceId:null==n?void 0:n.id,experienceName:null==n?void 0:n.name,experienceKey:null==n?void 0:n.key},{bucketingAllocation:I}),p)),C}retrieveVariation(e,t){return this.getSubItem("experiences",e,"variations",t,"id","id")}reset(){this._bucketedVisitors=new Map}putData(e,t={}){let i=this.getStoreKey(e),n=this.getData(e)||{};if(!nq(n,t)){let e=nx(n,t);if(this._bucketedVisitors.set(i,e),this._bucketedVisitors.size>this._localStoreLimit)for(let[e]of this._bucketedVisitors){this._bucketedVisitors.delete(e);break}if(this.dataStoreManager){let{segments:r={}}=n,a=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)0>t.indexOf(n[r])&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]]);return i}(n,["segments"]),{segments:o={}}=this.filterReportSegments(r),{segments:s}=this.filterReportSegments((null==t?void 0:t.segments)||{});s?this._asyncStorage?this.dataStoreManager.enqueue(i,nx(a,{segments:Object.assign(Object.assign({},o),s)})):this.dataStoreManager.set(i,nx(a,{segments:Object.assign(Object.assign({},o),s)})):this._asyncStorage?this.dataStoreManager.enqueue(i,e):this.dataStoreManager.set(i,e)}}}getData(e){let t=this.getStoreKey(e),i=this._bucketedVisitors.get(t)||null;return this.dataStoreManager?nx(i||{},this.dataStoreManager.get(t)||{}):i}getStoreKey(e){return`${this._accountId}-${this._projectId}-${e}`}selectLocations(e,t,i){var n,r,a,o,s,l,u,d,c,E,g,_,h,O,T,v,A,f,R,p;let N;let{locationProperties:C,identityField:I="key",forceEvent:S}=i;null===(r=null===(n=this._loggerManager)||void 0===n?void 0:n.trace)||void 0===r||r.call(n,"DataManager.selectLocations()",this._mapper({items:t,locationProperties:C}));let{locations:D=[]}=this.getData(e)||{},L=[];if(nB(t))for(let i=0,n=t.length;i<n;i++){if(!(null===(a=null==t?void 0:t[i])||void 0===a?void 0:a.rules))continue;N=this._ruleManager.isRuleMatched(C,t[i].rules,`ConfigLocation #${t[i][I]}`);let n=null===(l=null===(s=null===(o=null==t?void 0:t[i])||void 0===o?void 0:o[I])||void 0===s?void 0:s.toString)||void 0===l?void 0:l.call(s);if(!0===N)null===(d=null===(u=this._loggerManager)||void 0===u?void 0:u.info)||void 0===d||d.call(u,"DataManager.selectLocations()",nX.LOCATION_MATCH.replace("#",`#${n}`)),(!D.includes(n)||S)&&(this._eventManager.fire(tN.LOCATION_ACTIVATED,{visitorId:e,location:{id:null===(c=null==t?void 0:t[i])||void 0===c?void 0:c.id,key:null===(E=null==t?void 0:t[i])||void 0===E?void 0:E.key,name:null===(g=null==t?void 0:t[i])||void 0===g?void 0:g.name}},null,!0),null===(h=null===(_=this._loggerManager)||void 0===_?void 0:_.info)||void 0===h||h.call(_,"DataManager.selectLocations()",nX.LOCATION_ACTIVATED.replace("#",`#${n}`))),D.includes(n)||D.push(n),L.push(t[i]);else if(!1!==N)L.push(N);else if(!1===N&&D.includes(n)){this._eventManager.fire(tN.LOCATION_DEACTIVATED,{visitorId:e,location:{id:null===(O=null==t?void 0:t[i])||void 0===O?void 0:O.id,key:null===(T=null==t?void 0:t[i])||void 0===T?void 0:T.key,name:null===(v=null==t?void 0:t[i])||void 0===v?void 0:v.name}},null,!0);let r=D.findIndex(e=>e===n);D.splice(r,1),null===(f=null===(A=this._loggerManager)||void 0===A?void 0:A.info)||void 0===f||f.call(A,"DataManager.selectLocations()",nX.LOCATION_DEACTIVATED.replace("#",`#${n}`))}}return this.putData(e,{locations:D}),null===(p=null===(R=this._loggerManager)||void 0===R?void 0:R.debug)||void 0===p||p.call(R,"DataManager.selectLocations()",this._mapper({matchedRecords:L})),L}getBucketing(e,t,i){return this._getBucketingByField(e,t,"key",i)}getBucketingById(e,t,i){return this._getBucketingByField(e,t,"id",i)}convert(e,t,i,n,r,a){var o,s,l,u,d,c;let E="string"==typeof t?this.getEntity(t,"goals"):this.getEntityById(t,"goals");if(!(null==E?void 0:E.id)){null===(s=null===(o=this._loggerManager)||void 0===o?void 0:o.error)||void 0===s||s.call(o,"DataManager.convert()",nX.GOAL_NOT_FOUND);return}if(i){if(!(null==E?void 0:E.rules))return;let e=this._ruleManager.isRuleMatched(i,E.rules,`ConfigGoal #${t}`);if(Object.values(tp).includes(e))return e;if(!e){null===(u=null===(l=this._loggerManager)||void 0===l?void 0:l.error)||void 0===u||u.call(l,"DataManager.convert()",nX.GOAL_RULE_NOT_MATCH);return}}let g=null==a?void 0:a[t_.FORCE_MULTIPLE_TRANSACTIONS],{bucketing:_,goals:{[t.toString()]:h}={}}=this.getData(e)||{};return h&&(null===(c=null===(d=this._loggerManager)||void 0===d?void 0:d.debug)||void 0===c||c.call(d,"DataManager.convert()",nX.GOAL_FOUND.replace("#",t.toString()),this._mapper({visitorId:e,goalId:t})),!g)?void 0:(this.putData(e,{goals:{[t.toString()]:!0}}),h||(function(){var t,i;let n={goalId:E.id};_&&(n.bucketingData=_);let a={eventType:nY.CONVERSION,data:n};this._apiManager.enqueue(e,a,r),null===(i=null===(t=this._loggerManager)||void 0===t?void 0:t.trace)||void 0===i||i.call(t,"DataManager.convert()",this._mapper({event:a}))}).call(this),n&&(!h||g)&&(function(){var t,i;let a={goalId:E.id,goalData:n};_&&(a.bucketingData=_);let o={eventType:nY.CONVERSION,data:a};this._apiManager.enqueue(e,o,r),null===(i=null===(t=this._loggerManager)||void 0===t?void 0:t.trace)||void 0===i||i.call(t,"DataManager.convert()",this._mapper({event:o}))}).call(this),!0)}filterMatchedRecordsWithRule(e,t,i,n="id"){var r,a,o,s,l;let u;null===(a=null===(r=this._loggerManager)||void 0===r?void 0:r.trace)||void 0===a||a.call(r,"DataManager.filterMatchedRecordsWithRule()",this._mapper({items:e,visitorProperties:t}));let d=[];if(nB(e))for(let r=0,a=e.length;r<a;r++)(null===(o=null==e?void 0:e[r])||void 0===o?void 0:o.rules)&&(!0===(u=this._ruleManager.isRuleMatched(t,e[r].rules,`${i.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0===t?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"")} #${e[r][n]}`))?d.push(e[r]):!1!==u&&d.push(u));return null===(l=null===(s=this._loggerManager)||void 0===s?void 0:s.debug)||void 0===l||l.call(s,"DataManager.filterMatchedRecordsWithRule()",this._mapper({matchedRecords:d})),d}filterMatchedCustomSegments(e,t){var i,n,r,a,o;null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.trace)||void 0===n||n.call(i,"DataManager.filterMatchedCustomSegments()",this._mapper({items:e,visitorId:t}));let{segments:{[tD.CUSTOM_SEGMENTS]:s=[]}={}}=this.getData(t)||{},l=[];if(nB(e))for(let t=0,i=e.length;t<i;t++)(null===(r=null==e?void 0:e[t])||void 0===r?void 0:r.id)&&s.includes(e[t].id)&&l.push(e[t]);return null===(o=null===(a=this._loggerManager)||void 0===a?void 0:a.debug)||void 0===o||o.call(a,"DataManager.filterMatchedCustomSegments()",this._mapper({matchedRecords:l})),l}filterReportSegments(e){let t=Object.values(tD).map(e=>e),i={},n={};for(let r in e)t.includes(r)?i[r]=e[r]:n[r]=e[r];return{properties:Object.keys(n).length?n:null,segments:Object.keys(i).length?i:null}}getEntitiesList(e){var t,i;let n=[],r=n$[e]||e;return -1!==this._dataEntities.indexOf(r)&&(n=nG(this._data,r)||[]),null===(i=null===(t=this._loggerManager)||void 0===t?void 0:t.trace)||void 0===i||i.call(t,"DataManager.getEntitiesList()",this._mapper({entityType:r,list:n})),n}getEntitiesListObject(e,t="id"){return this.getEntitiesList(e).reduce((e,i)=>(e[i[t]]=i,e),{})}_getEntityByField(e,t,i="key"){var n,r,a;let o=n$[t]||t;null===(r=null===(n=this._loggerManager)||void 0===n?void 0:n.trace)||void 0===r||r.call(n,"DataManager._getEntityByField()",this._mapper({identity:e,entityType:o,identityField:i}));let s=this.getEntitiesList(o);if(nB(s)){for(let t=0,n=s.length;t<n;t++)if(s[t]&&String(null===(a=s[t])||void 0===a?void 0:a[i])===String(e))return s[t]}return null}getEntity(e,t){return this._getEntityByField(e,t,"key")}getEntities(e,t){return this.getItemsByKeys(e,t)}getEntityById(e,t){return this._getEntityByField(e,t,"id")}getEntitiesByIds(e,t){return this.getItemsByIds(e,t)}getItemsByKeys(e,t){var i;let n=this.getEntitiesList(t),r=[];if(nB(n))for(let t=0,a=n.length;t<a;t++)-1!==e.indexOf(null===(i=n[t])||void 0===i?void 0:i.key)&&r.push(n[t]);return r}getItemsByIds(e,t){var i,n,r;null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.trace)||void 0===n||n.call(i,"DataManager.getItemsByIds()",this._mapper({ids:e,path:t}));let a=[];if(nB(e)){let i=this.getEntitiesList(t);if(nB(i))for(let t=0,n=i.length;t<n;t++)-1!==e.indexOf(null===(r=i[t])||void 0===r?void 0:r.id)&&a.push(i[t])}return a}getSubItem(e,t,i,n,r,a){for(let o of this._getEntityByField(t,e,r)[i])if(o[a]===n)return o;return null}isValidConfigData(e){var t;return nV(e)&&(!!(null==e?void 0:e.account_id)&&!!(null===(t=null==e?void 0:e.project)||void 0===t?void 0:t.id)||!!e.error)}}class n0{constructor(e,{loggerManager:t}={}){this._listeners={},this._deferred={},this._loggerManager=t,this._mapper=(null==e?void 0:e.mapper)||(e=>e)}on(e,t){var i,n;(this._listeners[e]=this._listeners[e]||[]).push(t),null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.trace)||void 0===n||n.call(i,"EventManager.on()",{event:e}),Object.hasOwnProperty.call(this._deferred,e)&&this.fire(e,this._deferred[e].args,this._deferred[e].err)}removeListeners(e){Object.hasOwnProperty.call(this._listeners,e)&&delete this._listeners[e],Object.hasOwnProperty.call(this._deferred,e)&&delete this._deferred[e]}fire(e,t=null,i=null,n=!1){var r,a;for(let o of(null===(a=null===(r=this._loggerManager)||void 0===r?void 0:r.debug)||void 0===a||a.call(r,"EventManager.fire()",this._mapper({event:e,args:t,err:i,deferred:n})),this._listeners[e]||[]))Object.hasOwnProperty.call(this._listeners,e)&&"function"==typeof o&&o.apply(null,[this._mapper(t),i]);n&&!Object.hasOwnProperty.call(this._deferred,e)&&(this._deferred[e]={args:t,err:i})}}(tm||(tm={})).VARIAION_NOT_DECIDED="convert.com_variation_not_decided",(ty||(ty={})).FORCE_MULTIPLE_TRANSACTIONS="forceMultipleTransactions";let n5={EXPERIENCE_CONSTRUCTOR:"Experience Manager constructor has been called"};(function(e){e.OFF="OFF",e.EU_ONLY="EU ONLY",e.EEA_ONLY="EEA ONLY",e.WORLDWIDE="Worldwide"})(tM||(tM={})),function(e){e.AUDIENCE="audience",e.LOCATION="location",e.SEGMENT="segment",e.FEATURE="feature",e.GOAL="goal",e.EXPERIENCE="experience",e.VARIATION="variation"}(tF||(tF={})),function(e){e.ENABLED="enabled",e.DISABLED="disabled"}(tP||(tP={})),function(e){e.AMOUNT="amount",e.PRODUCTS_COUNT="productsCount",e.TRANSACTION_ID="transactionId"}(tb||(tb={})),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(tk||(tk={})),function(e){e.LOG="log",e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(tw||(tw={})),function(e){e.WEB="web",e.FULLSTACK="fullstack"}(tH||(tH={})),function(e){e.NO_DATA_FOUND="convert.com_no_data_found",e.NEED_MORE_DATA="convert.com_need_more_data"}(tB||(tB={})),function(e){e.READY="ready",e.CONFIG_UPDATED="config.updated",e.API_QUEUE_RELEASED="api.queue.released",e.BUCKETING="bucketing",e.CONVERSION="conversion",e.SEGMENTS="segments",e.LOCATION_ACTIVATED="location.activated",e.LOCATION_DEACTIVATED="location.deactivated",e.AUDIENCES="audiences",e.DATA_STORE_QUEUE_RELEASED="datastore.queue.released"}(tG||(tG={})),function(e){e.RICH_STRUCTURE="richStructure",e.CUSTOM_CODE="customCode",e.DEFAULT_CODE="defaultCode",e.DEFAULT_CODE_MULTIPAGE="defaultCodeMultipage",e.DEFAULT_REDIRECT="defaultRedirect",e.FULLSTACK_FEATURE="fullStackFeature"}(tx||(tx={})),function(e){e.IE="IE",e.CH="CH",e.FF="FF",e.OP="OP",e.SF="SF",e.EDG="EDG",e.MO="MO",e.NS="NS",e.OTH="OTH"}(tV||(tV={})),function(e){e.ALLPH="ALLPH",e.IPH="IPH",e.OTHPH="OTHPH",e.ALLTAB="ALLTAB",e.IPAD="IPAD",e.OTHTAB="OTHTAB",e.DESK="DESK",e.OTHDEV="OTHDEV"}(tq||(tq={})),function(e){e.COUNTRY="country",e.BROWSER="browser",e.DEVICES="devices",e.SOURCE="source",e.CAMPAIGN="campaign",e.VISITOR_TYPE="visitorType",e.CUSTOM_SEGMENTS="customSegments"}(tj||(tj={})),function(e){e.CAMPAIGN="campaign",e.SEARCH="search",e.REFERRAL="referral",e.DIRECT="direct"}(tW||(tW={})),function(e){e.NEW="new",e.RETURNING="returning"}(tK||(tK={}));class n1{constructor(e,{dataManager:t,loggerManager:i}){var n,r;this._dataManager=t,this._loggerManager=i,null===(r=null===(n=this._loggerManager)||void 0===n?void 0:n.trace)||void 0===r||r.call(n,"ExperienceManager()",n5.EXPERIENCE_CONSTRUCTOR)}getList(){return this._dataManager.getEntitiesList("experiences")}getExperience(e){return this._dataManager.getEntity(e,"experiences")}getExperienceById(e){return this._dataManager.getEntityById(e,"experiences")}getExperiences(e){return this._dataManager.getItemsByKeys(e,"experiences")}selectVariation(e,t,i){return this._dataManager.getBucketing(e,t,i)}selectVariationById(e,t,i){return this._dataManager.getBucketingById(e,t,i)}selectVariations(e,t){return this.getList().map(i=>this.selectVariation(e,null==i?void 0:i.key,t)).filter(e=>e&&!Object.values(tB).includes(e)&&!Object.values(tm).includes(e))}getVariation(e,t){return this._dataManager.getSubItem("experiences",e,"variations",t,"key","key")}getVariationById(e,t){return this._dataManager.getSubItem("experiences",e,"variations",t,"id","id")}}class n4{constructor(e,{dataManager:t,loggerManager:i}){var n,r;this._dataManager=t,this._loggerManager=i,null===(r=null===(n=this._loggerManager)||void 0===n?void 0:n.trace)||void 0===r||r.call(n,"FeatureManager()",nM.FEATURE_CONSTRUCTOR)}getList(){return this._dataManager.getEntitiesList("features")}getListAsObject(e="id"){return this._dataManager.getEntitiesListObject("features",e)}getFeature(e){return this._dataManager.getEntity(e,"features")}getFeatureById(e){return this._dataManager.getEntityById(e,"features")}getFeatures(e){return this._dataManager.getItemsByKeys(e,"features")}getFeatureVariableType(e,t){let i=this.getFeature(e);if(Object.prototype.hasOwnProperty.call(i,"variables")){let e=i.variables.find(e=>e.key===t);return(null==e?void 0:e.type)||null}return null}getFeatureVariableTypeById(e,t){let i=this.getFeatureById(e);if(Object.prototype.hasOwnProperty.call(i,"variables")){let e=i.variables.find(e=>e.key===t);return(null==e?void 0:e.type)||null}return null}isFeatureDeclared(e){return!!this._dataManager.getEntity(e,"features")}runFeature(e,t,i,n){let r=this._dataManager.getEntity(t,"features");if(!r)return{key:t,status:eL.DISABLED};{let a=this.runFeatures(e,i,{features:[t],experiences:n});return nF(a)?1===a.length?a[0]:a:{id:r.id,name:r.name,key:t,status:eL.DISABLED}}}isFeatureEnabled(e,t,i,n){return!!this._dataManager.getEntity(t,"features")&&nF(this.runFeatures(e,i,{features:[t],experiences:n}))}runFeatureById(e,t,i,n){let r=this._dataManager.getEntityById(t,"features");if(!r)return{id:t,status:eL.DISABLED};{let a=this.runFeatures(e,i,{features:[r.key],experiences:this._dataManager.getEntitiesByIds(n,"experiences").map(e=>e.key)});if(nF(a)){if(1===a.length)return a[0];{let e=a.filter(e=>Object.values(eF).includes(e));return e.length?e:a}}return{id:t,name:r.name,key:r.key,status:eL.DISABLED}}}runFeatures(e,t,i){var n,r,a,o,s,l,u,d,c,E,g,_,h,O,T,v,A,f;let{typeCasting:R=!0}=t,p=this.getListAsObject("id"),N=[],C=(i&&nF(null==i?void 0:i.experiences)?this._dataManager.getEntities(i.experiences,"experiences"):this._dataManager.getEntitiesList("experiences")).map(i=>{let n=this._dataManager.getBucketing(e,null==i?void 0:i.key,t);return Object.values(eF).includes(n),n}).filter(Boolean),I=C.filter(e=>Object.values(eF).includes(e));if(I.length)return I;for(let e in C){let t=C[e];for(let e in(null==t?void 0:t.changes)||[]){let C=null===(r=null===(n=null==t?void 0:t.changes)||void 0===n?void 0:n[e])||void 0===r?void 0:r.data;if((null===(o=null===(a=null==t?void 0:t.changes)||void 0===a?void 0:a[e])||void 0===o?void 0:o.type)!==eb.FULLSTACK_FEATURE){null===(l=null===(s=this._loggerManager)||void 0===s?void 0:s.warn)||void 0===l||l.call(s,"FeatureManager.runFeatures()",nM.VARIATION_CHANGE_NOT_SUPPORTED);continue}let I=null==C?void 0:C.feature_id;if(!I){null===(d=null===(u=this._loggerManager)||void 0===u?void 0:u.warn)||void 0===d||d.call(u,"FeatureManager.runFeatures()",nM.FEATURE_NOT_FOUND);continue}if(i&&nF(null==i?void 0:i.features)&&(null===(c=null==i?void 0:i.features)||void 0===c?void 0:c.indexOf(null===(E=p[String(I)])||void 0===E?void 0:E.key))!==-1||!(null==i?void 0:i.features)){let e=null==C?void 0:C.variables_data;if(e||null===(_=null===(g=this._loggerManager)||void 0===g?void 0:g.warn)||void 0===_||_.call(g,"FeatureManager.runFeatures()",nM.FEATURE_VARIABLES_NOT_FOUND),R&&nb(e))for(let t in e){let i=null===(O=null===(h=p[String(I)])||void 0===h?void 0:h.variables)||void 0===O?void 0:O.find(e=>e.key===t);(null==i?void 0:i.type)?e[t]=this.castType(e[t],i.type):null===(v=null===(T=this._loggerManager)||void 0===T?void 0:T.warn)||void 0===v||v.call(T,"FeatureManager.runFeatures()",nM.FEATURE_VARIABLES_TYPE_NOT_FOUND)}let i=Object.assign({experienceId:t.experienceId,experienceName:t.experienceName,experienceKey:t.experienceKey},{key:null===(A=p[String(I)])||void 0===A?void 0:A.key,name:null===(f=p[String(I)])||void 0===f?void 0:f.name,id:String(I),status:eL.ENABLED,variables:e});N.push(i)}}}if(!(null==i?void 0:i.features)){let e=N.map(e=>e.id);for(let t in p)-1===e.indexOf(p[t].id)&&N.push({id:p[t].id,name:p[t].name,key:p[t].key,status:eL.DISABLED})}return N}castType(e,t){return function(e,t){switch(t){case"boolean":if("true"===e)return!0;if("false"===e)return!1;return!!e;case"float":if(!0===e)return 1;if(!1===e)return 0;return parseFloat(e);case"json":if("object"==typeof e)return e;try{return JSON.parse(e)}catch(t){return String(e)}case"string":return String(e);case"integer":if(!0===e)return 1;if(!1===e)return 0;return parseInt(e);default:return e}}(e,t)}}function n6(e){return Array.isArray(e)&&e.length>0}function n3(e){return"object"==typeof e&&null!==e&&Object.keys(e).length>0}let n2=class{static equals(e,t,i){return Array.isArray(e)?this._returnNegationCheck(-1!==e.indexOf(t),i):n3(e)?this._returnNegationCheck(-1!==Object.keys(e).indexOf(String(t)),i):(e=String(e),t=String(t),e=e.valueOf().toLowerCase(),t=t.valueOf().toLowerCase(),this._returnNegationCheck(e===t,i))}static less(e,t,i){return typeof e==typeof t&&this._returnNegationCheck(e<t,i)}static lessEqual(e,t,i){return typeof e==typeof t&&this._returnNegationCheck(e<=t,i)}static contains(e,t,i){return(e=String(e),t=String(t),e=e.valueOf().toLowerCase(),0===(t=t.valueOf().toLowerCase()).replace(/^([\s]*)|([\s]*)$/g,"").length)?this._returnNegationCheck(!0,i):this._returnNegationCheck(-1!==e.indexOf(t),i)}static isIn(e,t,i=!1,n="|"){let r=String(e).split(n).map(e=>String(e));"string"==typeof t&&(t=t.split(n)),Array.isArray(t)||(t=[]),t=t.map(e=>String(e).valueOf().toLowerCase());for(let e=0;e<r.length;e++)if(-1!==t.indexOf(r[e]))return this._returnNegationCheck(!0,i);return this._returnNegationCheck(!1,i)}static startsWith(e,t,i){return e=String(e).valueOf().toLowerCase(),t=String(t).valueOf().toLowerCase(),this._returnNegationCheck(0===e.indexOf(t),i)}static endsWith(e,t,i){return e=String(e).valueOf().toLowerCase(),t=String(t).valueOf().toLowerCase(),this._returnNegationCheck(-1!==e.indexOf(t,e.length-t.length),i)}static regexMatches(e,t,i){e=String(e).valueOf().toLowerCase();let n=RegExp(t=String(t).valueOf(),"i");return this._returnNegationCheck(n.test(e),i)}static _returnNegationCheck(e,t=!1){return t?!e:e}};n2.equalsNumber=n2.equals,n2.matches=n2.equals,"function"==typeof SuppressedError&&SuppressedError,(tY||(tY={})).VARIAION_NOT_DECIDED="convert.com_variation_not_decided",(tQ||(tQ={})).FORCE_MULTIPLE_TRANSACTIONS="forceMultipleTransactions",function(e){e.OFF="OFF",e.EU_ONLY="EU ONLY",e.EEA_ONLY="EEA ONLY",e.WORLDWIDE="Worldwide"}(t$||(t$={})),function(e){e.AUDIENCE="audience",e.LOCATION="location",e.SEGMENT="segment",e.FEATURE="feature",e.GOAL="goal",e.EXPERIENCE="experience",e.VARIATION="variation"}(tz||(tz={})),function(e){e.ENABLED="enabled",e.DISABLED="disabled"}(tX||(tX={})),function(e){e.AMOUNT="amount",e.PRODUCTS_COUNT="productsCount",e.TRANSACTION_ID="transactionId"}(tJ||(tJ={})),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(tZ||(tZ={})),function(e){e.LOG="log",e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(t0||(t0={})),function(e){e.WEB="web",e.FULLSTACK="fullstack"}(t5||(t5={})),function(e){e.NO_DATA_FOUND="convert.com_no_data_found",e.NEED_MORE_DATA="convert.com_need_more_data"}(t1||(t1={})),function(e){e.READY="ready",e.CONFIG_UPDATED="config.updated",e.API_QUEUE_RELEASED="api.queue.released",e.BUCKETING="bucketing",e.CONVERSION="conversion",e.SEGMENTS="segments",e.LOCATION_ACTIVATED="location.activated",e.LOCATION_DEACTIVATED="location.deactivated",e.AUDIENCES="audiences",e.DATA_STORE_QUEUE_RELEASED="datastore.queue.released"}(t4||(t4={})),function(e){e.RICH_STRUCTURE="richStructure",e.CUSTOM_CODE="customCode",e.DEFAULT_CODE="defaultCode",e.DEFAULT_CODE_MULTIPAGE="defaultCodeMultipage",e.DEFAULT_REDIRECT="defaultRedirect",e.FULLSTACK_FEATURE="fullStackFeature"}(t6||(t6={})),function(e){e.IE="IE",e.CH="CH",e.FF="FF",e.OP="OP",e.SF="SF",e.EDG="EDG",e.MO="MO",e.NS="NS",e.OTH="OTH"}(t3||(t3={})),function(e){e.ALLPH="ALLPH",e.IPH="IPH",e.OTHPH="OTHPH",e.ALLTAB="ALLTAB",e.IPAD="IPAD",e.OTHTAB="OTHTAB",e.DESK="DESK",e.OTHDEV="OTHDEV"}(t2||(t2={})),function(e){e.COUNTRY="country",e.BROWSER="browser",e.DEVICES="devices",e.SOURCE="source",e.CAMPAIGN="campaign",e.VISITOR_TYPE="visitorType",e.CUSTOM_SEGMENTS="customSegments"}(t9||(t9={})),function(e){e.CAMPAIGN="campaign",e.SEARCH="search",e.REFERRAL="referral",e.DIRECT="direct"}(t7||(t7={})),function(e){e.NEW="new",e.RETURNING="returning"}(t8||(t8={})),function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.ImUsed=226]="ImUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.UriTooLong=414]="UriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RangeNotSatisfiable=416]="RangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired"}(ie||(ie={})),o={exports:{}},function(){let e=e=>new TextEncoder().encode(e);function t(t,i){let n,r,a,o,s,l;for("string"==typeof t&&(t=e(t)),n=3&t.length,r=t.length-n,a=i,l=0;l<r;)s=255&t[l]|(255&t[++l])<<8|(255&t[++l])<<16|(255&t[++l])<<24,++l,a^=s=(65535&(s=(s=(65535&s)*3432918353+(((s>>>16)*3432918353&65535)<<16)&4294967295)<<15|s>>>17))*461845907+(((s>>>16)*461845907&65535)<<16)&4294967295,a=(65535&(o=(65535&(a=a<<13|a>>>19))*5+(((a>>>16)*5&65535)<<16)&4294967295))+27492+(((o>>>16)+58964&65535)<<16);switch(s=0,n){case 3:s^=(255&t[l+2])<<16;case 2:s^=(255&t[l+1])<<8;case 1:s^=255&t[l],a^=s=(65535&(s=(s=(65535&s)*3432918353+(((s>>>16)*3432918353&65535)<<16)&4294967295)<<15|s>>>17))*461845907+(((s>>>16)*461845907&65535)<<16)&4294967295}return a^=t.length,a^=a>>>16,a=(65535&a)*2246822507+(((a>>>16)*2246822507&65535)<<16)&4294967295,a^=a>>>13,a=(65535&a)*3266489909+(((a>>>16)*3266489909&65535)<<16)&4294967295,(a^=a>>>16)>>>0}t.v2=function(t,i){"string"==typeof t&&(t=e(t));let n=t.length,r=i^n,a=0,o;for(;n>=4;)o=(65535&(o=255&t[a]|(255&t[++a])<<8|(255&t[++a])<<16|(255&t[++a])<<24))*1540483477+(((o>>>16)*1540483477&65535)<<16),o^=o>>>24,r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16)^(o=(65535&o)*1540483477+(((o>>>16)*1540483477&65535)<<16)),n-=4,++a;switch(n){case 3:r^=(255&t[a+2])<<16;case 2:r^=(255&t[a+1])<<8;case 1:r^=255&t[a],r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16)}return r^=r>>>13,r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16),(r^=r>>>15)>>>0},t.v3=t,o.exports=t}(),(it||(it={})).VARIAION_NOT_DECIDED="convert.com_variation_not_decided",(ii||(ii={})).FORCE_MULTIPLE_TRANSACTIONS="forceMultipleTransactions";let n9={RULE_NOT_VALID:"Provided rule is not valid",RULE_DATA_NOT_VALID:"Provided rule data is not valid",RULE_MATCH_TYPE_NOT_SUPPORTED:'Provided rule matching type "#" is not supported',RULE_ERROR:"Rule error"},n7={RULE_CONSTRUCTOR:"Rule Manager constructor has been called",PROCESSING_ENTITY:"Processing #",RULE_NOT_MATCH:"Rule does not match",RULE_MATCH:"Found matched rule at OR block #",RULE_MATCH_AND:"AND block rule macthed",RULE_MATCH_START:"About to evaluate rule #"};(function(e){e.OFF="OFF",e.EU_ONLY="EU ONLY",e.EEA_ONLY="EEA ONLY",e.WORLDWIDE="Worldwide"})(ir||(ir={})),function(e){e.AUDIENCE="audience",e.LOCATION="location",e.SEGMENT="segment",e.FEATURE="feature",e.GOAL="goal",e.EXPERIENCE="experience",e.VARIATION="variation"}(ia||(ia={})),function(e){e.ENABLED="enabled",e.DISABLED="disabled"}(io||(io={})),function(e){e.AMOUNT="amount",e.PRODUCTS_COUNT="productsCount",e.TRANSACTION_ID="transactionId"}(is||(is={})),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(il||(il={})),function(e){e.LOG="log",e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(iu||(iu={})),function(e){e.WEB="web",e.FULLSTACK="fullstack"}(id||(id={})),function(e){e.NO_DATA_FOUND="convert.com_no_data_found",e.NEED_MORE_DATA="convert.com_need_more_data"}(ic||(ic={})),function(e){e.READY="ready",e.CONFIG_UPDATED="config.updated",e.API_QUEUE_RELEASED="api.queue.released",e.BUCKETING="bucketing",e.CONVERSION="conversion",e.SEGMENTS="segments",e.LOCATION_ACTIVATED="location.activated",e.LOCATION_DEACTIVATED="location.deactivated",e.AUDIENCES="audiences",e.DATA_STORE_QUEUE_RELEASED="datastore.queue.released"}(iE||(iE={})),function(e){e.RICH_STRUCTURE="richStructure",e.CUSTOM_CODE="customCode",e.DEFAULT_CODE="defaultCode",e.DEFAULT_CODE_MULTIPAGE="defaultCodeMultipage",e.DEFAULT_REDIRECT="defaultRedirect",e.FULLSTACK_FEATURE="fullStackFeature"}(ig||(ig={})),function(e){e.IE="IE",e.CH="CH",e.FF="FF",e.OP="OP",e.SF="SF",e.EDG="EDG",e.MO="MO",e.NS="NS",e.OTH="OTH"}(i_||(i_={})),function(e){e.ALLPH="ALLPH",e.IPH="IPH",e.OTHPH="OTHPH",e.ALLTAB="ALLTAB",e.IPAD="IPAD",e.OTHTAB="OTHTAB",e.DESK="DESK",e.OTHDEV="OTHDEV"}(ih||(ih={})),function(e){e.COUNTRY="country",e.BROWSER="browser",e.DEVICES="devices",e.SOURCE="source",e.CAMPAIGN="campaign",e.VISITOR_TYPE="visitorType",e.CUSTOM_SEGMENTS="customSegments"}(iO||(iO={})),function(e){e.CAMPAIGN="campaign",e.SEARCH="search",e.REFERRAL="referral",e.DIRECT="direct"}(iT||(iT={})),function(e){e.NEW="new",e.RETURNING="returning"}(iv||(iv={}));class n8{constructor(e,{loggerManager:t}={}){var i,n,r,a,o;this._comparisonProcessor=n2,this._negation="!",this._keys_case_sensitive=!0,this._loggerManager=t,this._comparisonProcessor=(null===(i=null==e?void 0:e.rules)||void 0===i?void 0:i.comparisonProcessor)||n2,this._negation=String((null===(n=null==e?void 0:e.rules)||void 0===n?void 0:n.negation)||"!"),this._keys_case_sensitive=(null===(r=null==e?void 0:e.rules)||void 0===r?void 0:r.keys_case_sensitive)||!0,this._mapper=(null==e?void 0:e.mapper)||(e=>e),null===(o=null===(a=this._loggerManager)||void 0===a?void 0:a.trace)||void 0===o||o.call(a,"RuleManager()",n7.RULE_CONSTRUCTOR,this)}set comparisonProcessor(e){this._comparisonProcessor=e}get comparisonProcessor(){return this._comparisonProcessor}getComparisonProcessorMethods(){return Object.getOwnPropertyNames(this._comparisonProcessor).filter(e=>"function"==typeof this._comparisonProcessor[e])}isRuleMatched(e,t,i){var n,r,a,o,s,l,u,d,c,E;let g;if(null===(r=null===(n=this._loggerManager)||void 0===n?void 0:n.trace)||void 0===r||r.call(n,"RuleManager.isRuleMatched()",this._mapper({data:e,ruleSet:t})),i&&(null===(o=null===(a=this._loggerManager)||void 0===a?void 0:a.info)||void 0===o||o.call(a,"RuleManager.isRuleMatched()",n7.PROCESSING_ENTITY.replace("#",i))),Object.prototype.hasOwnProperty.call(t,"OR")&&n6(null==t?void 0:t.OR)){for(let n=0,r=t.OR.length;n<r;n++)if(g=this._processAND(e,t.OR[n]),Object.values(ic).includes(g)?null===(l=null===(s=this._loggerManager)||void 0===s?void 0:s.info)||void 0===l||l.call(s,"RuleManager.isRuleMatched()",i||"",n9.RULE_ERROR):null===(d=null===(u=this._loggerManager)||void 0===u?void 0:u.info)||void 0===d||d.call(u,"RuleManager.isRuleMatched()",i||"",!1===g?n7.RULE_NOT_MATCH:n7.RULE_MATCH.replace("#",String(n))),!1!==g)return g}else null===(E=null===(c=this._loggerManager)||void 0===c?void 0:c.warn)||void 0===E||E.call(c,"RuleManager.isRuleMatched()",i||"",n9.RULE_NOT_VALID);return!1}isValidRule(e){var t,i;return null===(i=null===(t=this._loggerManager)||void 0===t?void 0:t.trace)||void 0===i||i.call(t,"RuleManager.isValidRule()",this._mapper({rule:e})),Object.prototype.hasOwnProperty.call(e,"matching")&&"object"==typeof e.matching&&Object.prototype.hasOwnProperty.call(e.matching,"match_type")&&"string"==typeof e.matching.match_type&&Object.prototype.hasOwnProperty.call(e.matching,"negated")&&"boolean"==typeof e.matching.negated&&Object.prototype.hasOwnProperty.call(e,"value")}_processAND(e,t){var i,n,r,a;let o;if(Object.prototype.hasOwnProperty.call(t,"AND")&&n6(null==t?void 0:t.AND)){for(let i=0,n=t.AND.length;i<n;i++)if(!1===(o=this._processORWHEN(e,t.AND[i])))return!1;return!1!==o&&(null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.info)||void 0===n||n.call(i,"RuleManager._processAND()",n7.RULE_MATCH_AND)),o}return null===(a=null===(r=this._loggerManager)||void 0===r?void 0:r.warn)||void 0===a||a.call(r,"RuleManager._processAND()",n9.RULE_NOT_VALID),!1}_processORWHEN(e,t){var i,n;let r;if(Object.prototype.hasOwnProperty.call(t,"OR_WHEN")&&n6(null==t?void 0:t.OR_WHEN)){for(let i=0,n=t.OR_WHEN.length;i<n;i++)if(!1!==(r=this._processRuleItem(e,t.OR_WHEN[i])))return r}else null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.warn)||void 0===n||n.call(i,"RuleManager._processORWHEN()",n9.RULE_NOT_VALID);return!1}_processRuleItem(e,t){var i,n,r,a,o,s,l,u,d,c,E,g,_;if(this.isValidRule(t))try{let c=t.matching.negated||!1,E=t.matching.match_type;if(-1!==this.getComparisonProcessorMethods().indexOf(E)){if(e&&"object"==typeof e){if(this.isUsingCustomInterface(e)){if(null==t?void 0:t.rule_type)for(let a of(null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.info)||void 0===n||n.call(i,"RuleManager._processRuleItem()",n7.RULE_MATCH_START.replace("#",t.rule_type)),Object.getOwnPropertyNames(e.constructor.prototype))){if("constructor"===a)continue;let i=`get ${t.rule_type.replace(/_/g," ")}`.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0===t?e.toLowerCase():e.toUpperCase()}).replace(/\s+/g,"");if(a===i||(null===(r=null==e?void 0:e.mapper)||void 0===r?void 0:r.call(e,a))===i){let i=e[a](t);if(Object.values(ic).includes(i)||"js_condition"===t.rule_type)return i;return this._comparisonProcessor[E](i,t.value,c)}}}else if(n3(e))for(let i of Object.keys(e)){let n=this._keys_case_sensitive?i:i.toLowerCase(),r=this._keys_case_sensitive?t.key:String(t.key).toLowerCase();if(n===r)return this._comparisonProcessor[E](e[i],t.value,c)}else null===(o=null===(a=this._loggerManager)||void 0===a?void 0:a.trace)||void 0===o||o.call(a,"RuleManager._processRuleItem()",{warn:n9.RULE_DATA_NOT_VALID,data:e})}else null===(l=null===(s=this._loggerManager)||void 0===s?void 0:s.trace)||void 0===l||l.call(s,"RuleManager._processRuleItem()",{warn:n9.RULE_NOT_VALID,data:e,rule:t})}else null===(d=null===(u=this._loggerManager)||void 0===u?void 0:u.warn)||void 0===d||d.call(u,"RuleManager._processRuleItem()",n9.RULE_MATCH_TYPE_NOT_SUPPORTED.replace("#",E))}catch(e){null===(E=null===(c=this._loggerManager)||void 0===c?void 0:c.error)||void 0===E||E.call(c,"RuleManager._processRuleItem()",{error:e.message})}else null===(_=null===(g=this._loggerManager)||void 0===g?void 0:g.warn)||void 0===_||_.call(g,"RuleManager._processRuleItem()",n9.RULE_NOT_VALID);return!1}isUsingCustomInterface(e){return n3(e)&&Object.prototype.hasOwnProperty.call(e,"name")&&"RuleData"===e.name}}(iA||(iA={})).VARIAION_NOT_DECIDED="convert.com_variation_not_decided",(iR||(iR={})).FORCE_MULTIPLE_TRANSACTIONS="forceMultipleTransactions";let re={SEGMENTS_NOT_FOUND:"Segments not found",CUSTOM_SEGMENTS_KEY_FOUND:"Custom segments key already set"};(function(e){e.OFF="OFF",e.EU_ONLY="EU ONLY",e.EEA_ONLY="EEA ONLY",e.WORLDWIDE="Worldwide"})(ip||(ip={})),function(e){e.AUDIENCE="audience",e.LOCATION="location",e.SEGMENT="segment",e.FEATURE="feature",e.GOAL="goal",e.EXPERIENCE="experience",e.VARIATION="variation"}(iN||(iN={})),function(e){e.ENABLED="enabled",e.DISABLED="disabled"}(iC||(iC={})),function(e){e.AMOUNT="amount",e.PRODUCTS_COUNT="productsCount",e.TRANSACTION_ID="transactionId"}(iI||(iI={})),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(iS||(iS={})),function(e){e.LOG="log",e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(iD||(iD={})),function(e){e.WEB="web",e.FULLSTACK="fullstack"}(iL||(iL={})),function(e){e.NO_DATA_FOUND="convert.com_no_data_found",e.NEED_MORE_DATA="convert.com_need_more_data"}(iU||(iU={})),function(e){e.READY="ready",e.CONFIG_UPDATED="config.updated",e.API_QUEUE_RELEASED="api.queue.released",e.BUCKETING="bucketing",e.CONVERSION="conversion",e.SEGMENTS="segments",e.LOCATION_ACTIVATED="location.activated",e.LOCATION_DEACTIVATED="location.deactivated",e.AUDIENCES="audiences",e.DATA_STORE_QUEUE_RELEASED="datastore.queue.released"}(im||(im={})),function(e){e.RICH_STRUCTURE="richStructure",e.CUSTOM_CODE="customCode",e.DEFAULT_CODE="defaultCode",e.DEFAULT_CODE_MULTIPAGE="defaultCodeMultipage",e.DEFAULT_REDIRECT="defaultRedirect",e.FULLSTACK_FEATURE="fullStackFeature"}(iy||(iy={})),function(e){e.IE="IE",e.CH="CH",e.FF="FF",e.OP="OP",e.SF="SF",e.EDG="EDG",e.MO="MO",e.NS="NS",e.OTH="OTH"}(iM||(iM={})),function(e){e.ALLPH="ALLPH",e.IPH="IPH",e.OTHPH="OTHPH",e.ALLTAB="ALLTAB",e.IPAD="IPAD",e.OTHTAB="OTHTAB",e.DESK="DESK",e.OTHDEV="OTHDEV"}(iF||(iF={})),function(e){e.COUNTRY="country",e.BROWSER="browser",e.DEVICES="devices",e.SOURCE="source",e.CAMPAIGN="campaign",e.VISITOR_TYPE="visitorType",e.CUSTOM_SEGMENTS="customSegments"}(iP||(iP={})),function(e){e.CAMPAIGN="campaign",e.SEARCH="search",e.REFERRAL="referral",e.DIRECT="direct"}(ib||(ib={})),function(e){e.NEW="new",e.RETURNING="returning"}(ik||(ik={}));class rt{static equals(e,t,i){var n;return Array.isArray(e)?this._returnNegationCheck(-1!==e.indexOf(t),i):"object"==typeof(n=e)&&null!==n&&Object.keys(n).length>0?this._returnNegationCheck(-1!==Object.keys(e).indexOf(String(t)),i):(e=String(e),t=String(t),e=e.valueOf().toLowerCase(),t=t.valueOf().toLowerCase(),this._returnNegationCheck(e===t,i))}static less(e,t,i){return typeof e==typeof t&&this._returnNegationCheck(e<t,i)}static lessEqual(e,t,i){return typeof e==typeof t&&this._returnNegationCheck(e<=t,i)}static contains(e,t,i){return(e=String(e),t=String(t),e=e.valueOf().toLowerCase(),0===(t=t.valueOf().toLowerCase()).replace(/^([\s]*)|([\s]*)$/g,"").length)?this._returnNegationCheck(!0,i):this._returnNegationCheck(-1!==e.indexOf(t),i)}static isIn(e,t,i=!1,n="|"){let r=String(e).split(n).map(e=>String(e));"string"==typeof t&&(t=t.split(n)),Array.isArray(t)||(t=[]),t=t.map(e=>String(e).valueOf().toLowerCase());for(let e=0;e<r.length;e++)if(-1!==t.indexOf(r[e]))return this._returnNegationCheck(!0,i);return this._returnNegationCheck(!1,i)}static startsWith(e,t,i){return e=String(e).valueOf().toLowerCase(),t=String(t).valueOf().toLowerCase(),this._returnNegationCheck(0===e.indexOf(t),i)}static endsWith(e,t,i){return e=String(e).valueOf().toLowerCase(),t=String(t).valueOf().toLowerCase(),this._returnNegationCheck(-1!==e.indexOf(t,e.length-t.length),i)}static regexMatches(e,t,i){e=String(e).valueOf().toLowerCase();let n=RegExp(t=String(t).valueOf(),"i");return this._returnNegationCheck(n.test(e),i)}static _returnNegationCheck(e,t=!1){return t?!e:e}}rt.equalsNumber=rt.equals,rt.matches=rt.equals,"function"==typeof SuppressedError&&SuppressedError,(iw||(iw={})).VARIAION_NOT_DECIDED="convert.com_variation_not_decided",(iH||(iH={})).FORCE_MULTIPLE_TRANSACTIONS="forceMultipleTransactions",function(e){e.OFF="OFF",e.EU_ONLY="EU ONLY",e.EEA_ONLY="EEA ONLY",e.WORLDWIDE="Worldwide"}(iB||(iB={})),function(e){e.AUDIENCE="audience",e.LOCATION="location",e.SEGMENT="segment",e.FEATURE="feature",e.GOAL="goal",e.EXPERIENCE="experience",e.VARIATION="variation"}(iG||(iG={})),function(e){e.ENABLED="enabled",e.DISABLED="disabled"}(ix||(ix={})),function(e){e.AMOUNT="amount",e.PRODUCTS_COUNT="productsCount",e.TRANSACTION_ID="transactionId"}(iV||(iV={})),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(iq||(iq={})),function(e){e.LOG="log",e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(ij||(ij={})),function(e){e.WEB="web",e.FULLSTACK="fullstack"}(iW||(iW={})),function(e){e.NO_DATA_FOUND="convert.com_no_data_found",e.NEED_MORE_DATA="convert.com_need_more_data"}(iK||(iK={})),function(e){e.READY="ready",e.CONFIG_UPDATED="config.updated",e.API_QUEUE_RELEASED="api.queue.released",e.BUCKETING="bucketing",e.CONVERSION="conversion",e.SEGMENTS="segments",e.LOCATION_ACTIVATED="location.activated",e.LOCATION_DEACTIVATED="location.deactivated",e.AUDIENCES="audiences",e.DATA_STORE_QUEUE_RELEASED="datastore.queue.released"}(iY||(iY={})),function(e){e.RICH_STRUCTURE="richStructure",e.CUSTOM_CODE="customCode",e.DEFAULT_CODE="defaultCode",e.DEFAULT_CODE_MULTIPAGE="defaultCodeMultipage",e.DEFAULT_REDIRECT="defaultRedirect",e.FULLSTACK_FEATURE="fullStackFeature"}(iQ||(iQ={})),function(e){e.IE="IE",e.CH="CH",e.FF="FF",e.OP="OP",e.SF="SF",e.EDG="EDG",e.MO="MO",e.NS="NS",e.OTH="OTH"}(i$||(i$={})),function(e){e.ALLPH="ALLPH",e.IPH="IPH",e.OTHPH="OTHPH",e.ALLTAB="ALLTAB",e.IPAD="IPAD",e.OTHTAB="OTHTAB",e.DESK="DESK",e.OTHDEV="OTHDEV"}(iz||(iz={})),function(e){e.COUNTRY="country",e.BROWSER="browser",e.DEVICES="devices",e.SOURCE="source",e.CAMPAIGN="campaign",e.VISITOR_TYPE="visitorType",e.CUSTOM_SEGMENTS="customSegments"}(iX||(iX={})),function(e){e.CAMPAIGN="campaign",e.SEARCH="search",e.REFERRAL="referral",e.DIRECT="direct"}(iJ||(iJ={})),function(e){e.NEW="new",e.RETURNING="returning"}(iZ||(iZ={})),function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.ImUsed=226]="ImUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.UriTooLong=414]="UriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RangeNotSatisfiable=416]="RangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired"}(i0||(i0={})),s={exports:{}},function(){let e=e=>new TextEncoder().encode(e);function t(t,i){let n,r,a,o,s,l;for("string"==typeof t&&(t=e(t)),n=3&t.length,r=t.length-n,a=i,l=0;l<r;)s=255&t[l]|(255&t[++l])<<8|(255&t[++l])<<16|(255&t[++l])<<24,++l,a^=s=(65535&(s=(s=(65535&s)*3432918353+(((s>>>16)*3432918353&65535)<<16)&4294967295)<<15|s>>>17))*461845907+(((s>>>16)*461845907&65535)<<16)&4294967295,a=(65535&(o=(65535&(a=a<<13|a>>>19))*5+(((a>>>16)*5&65535)<<16)&4294967295))+27492+(((o>>>16)+58964&65535)<<16);switch(s=0,n){case 3:s^=(255&t[l+2])<<16;case 2:s^=(255&t[l+1])<<8;case 1:s^=255&t[l],a^=s=(65535&(s=(s=(65535&s)*3432918353+(((s>>>16)*3432918353&65535)<<16)&4294967295)<<15|s>>>17))*461845907+(((s>>>16)*461845907&65535)<<16)&4294967295}return a^=t.length,a^=a>>>16,a=(65535&a)*2246822507+(((a>>>16)*2246822507&65535)<<16)&4294967295,a^=a>>>13,a=(65535&a)*3266489909+(((a>>>16)*3266489909&65535)<<16)&4294967295,(a^=a>>>16)>>>0}t.v2=function(t,i){"string"==typeof t&&(t=e(t));let n=t.length,r=i^n,a=0,o;for(;n>=4;)o=(65535&(o=255&t[a]|(255&t[++a])<<8|(255&t[++a])<<16|(255&t[++a])<<24))*1540483477+(((o>>>16)*1540483477&65535)<<16),o^=o>>>24,r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16)^(o=(65535&o)*1540483477+(((o>>>16)*1540483477&65535)<<16)),n-=4,++a;switch(n){case 3:r^=(255&t[a+2])<<16;case 2:r^=(255&t[a+1])<<8;case 1:r^=255&t[a],r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16)}return r^=r>>>13,r=(65535&r)*1540483477+(((r>>>16)*1540483477&65535)<<16),(r^=r>>>15)>>>0},t.v3=t,s.exports=t}();class ri{constructor(e,{dataManager:t,ruleManager:i,loggerManager:n}){this._dataManager=t,this._ruleManager=i,this._loggerManager=n,this._data=function(e,t,i,n=!1){try{if("object"==typeof e){let i=t.split(".").reduce((e,t)=>e[t],e);if(i||n&&(!1===i||0===i))return i}}catch(e){}return null}(e,"data")}getSegments(e){let t=this._dataManager.getData(e)||{},{segments:i}=this._dataManager.filterReportSegments(null==t?void 0:t.segments);return i}putSegments(e,t){let{segments:i}=this._dataManager.filterReportSegments(t);i&&this._dataManager.putData(e,{segments:i})}setCustomSegments(e,t,i){var n,r,a,o,s;let l;let u=this._dataManager.getData(e)||{},{segments:{[iP.CUSTOM_SEGMENTS]:d=[]}={}}=u,c=[],E=!1;for(let e of t){if(i&&!E&&(E=this._ruleManager.isRuleMatched(i,null==e?void 0:e.rules,`ConfigSegment #${null==e?void 0:e.id}`),Object.values(iU).includes(E)))return E;if(!i||E){let t=null===(n=null==e?void 0:e.id)||void 0===n?void 0:n.toString();d.includes(t)?null===(a=null===(r=this._loggerManager)||void 0===r?void 0:r.warn)||void 0===a||a.call(r,"SegmentsManager.setCustomSegments()",re.CUSTOM_SEGMENTS_KEY_FOUND):c.push(t)}}return c.length?(l=Object.assign(Object.assign({},u.segments||{}),{[iP.CUSTOM_SEGMENTS]:[...d,...c]}),this.putSegments(e,l)):null===(s=null===(o=this._loggerManager)||void 0===o?void 0:o.warn)||void 0===s||s.call(o,"SegmentsManager.setCustomSegments()",re.SEGMENTS_NOT_FOUND),l}selectCustomSegments(e,t,i){let n=this._dataManager.getEntities(t,"segments");return this.setCustomSegments(e,n,i)}selectCustomSegmentsByIds(e,t,i){let n=this._dataManager.getEntitiesByIds(t,"segments");return this.setCustomSegments(e,n,i)}}(i5||(i5={})).VARIAION_NOT_DECIDED="convert.com_variation_not_decided",(i1||(i1={})).FORCE_MULTIPLE_TRANSACTIONS="forceMultipleTransactions",function(e){e.OFF="OFF",e.EU_ONLY="EU ONLY",e.EEA_ONLY="EEA ONLY",e.WORLDWIDE="Worldwide"}(i4||(i4={})),function(e){e.AUDIENCE="audience",e.LOCATION="location",e.SEGMENT="segment",e.FEATURE="feature",e.GOAL="goal",e.EXPERIENCE="experience",e.VARIATION="variation"}(i6||(i6={})),function(e){e.ENABLED="enabled",e.DISABLED="disabled"}(i3||(i3={})),function(e){e.AMOUNT="amount",e.PRODUCTS_COUNT="productsCount",e.TRANSACTION_ID="transactionId"}(i2||(i2={})),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i9||(i9={})),function(e){e.LOG="log",e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(i7||(i7={})),function(e){e.WEB="web",e.FULLSTACK="fullstack"}(i8||(i8={})),function(e){e.NO_DATA_FOUND="convert.com_no_data_found",e.NEED_MORE_DATA="convert.com_need_more_data"}(ne||(ne={})),function(e){e.READY="ready",e.CONFIG_UPDATED="config.updated",e.API_QUEUE_RELEASED="api.queue.released",e.BUCKETING="bucketing",e.CONVERSION="conversion",e.SEGMENTS="segments",e.LOCATION_ACTIVATED="location.activated",e.LOCATION_DEACTIVATED="location.deactivated",e.AUDIENCES="audiences",e.DATA_STORE_QUEUE_RELEASED="datastore.queue.released"}(nt||(nt={})),function(e){e.RICH_STRUCTURE="richStructure",e.CUSTOM_CODE="customCode",e.DEFAULT_CODE="defaultCode",e.DEFAULT_CODE_MULTIPAGE="defaultCodeMultipage",e.DEFAULT_REDIRECT="defaultRedirect",e.FULLSTACK_FEATURE="fullStackFeature"}(ni||(ni={})),function(e){e.IE="IE",e.CH="CH",e.FF="FF",e.OP="OP",e.SF="SF",e.EDG="EDG",e.MO="MO",e.NS="NS",e.OTH="OTH"}(nn||(nn={})),function(e){e.ALLPH="ALLPH",e.IPH="IPH",e.OTHPH="OTHPH",e.ALLTAB="ALLTAB",e.IPAD="IPAD",e.OTHTAB="OTHTAB",e.DESK="DESK",e.OTHDEV="OTHDEV"}(nr||(nr={})),function(e){e.COUNTRY="country",e.BROWSER="browser",e.DEVICES="devices",e.SOURCE="source",e.CAMPAIGN="campaign",e.VISITOR_TYPE="visitorType",e.CUSTOM_SEGMENTS="customSegments"}(na||(na={})),function(e){e.CAMPAIGN="campaign",e.SEARCH="search",e.REFERRAL="referral",e.DIRECT="direct"}(no||(no={})),function(e){e.NEW="new",e.RETURNING="returning"}(ns||(ns={}));let rn=i9.TRACE;class rr{constructor(e=console,t=rn,i){this._defaultMapper={[i7.LOG]:i7.LOG,[i7.DEBUG]:i7.DEBUG,[i7.INFO]:i7.INFO,[i7.WARN]:i7.WARN,[i7.ERROR]:i7.ERROR,[i7.TRACE]:i7.TRACE},this._clients=[],this.addClient(e,t,i)}_isValidLevel(e){return Object.values(i9).includes(e)}_isValidMethod(e){return Object.values(i7).includes(e)}_log(e,t,...i){this._clients.forEach(n=>{var r,a;if(t>=n.level&&i9.SILENT!==t){let t=n.sdk[n.mapper[e]];t?t.call(n.sdk,...i):(console.log(`Info: Unable to find method "${e}()" in client sdk:`,null===(a=null===(r=n.sdk)||void 0===r?void 0:r.constructor)||void 0===a?void 0:a.name),console[e](...i))}})}log(e,...t){if(!this._isValidLevel(e)){console.error("Invalid Log Level");return}this._log(i7.LOG,e,...t)}trace(...e){this._log(i7.TRACE,i9.TRACE,...e)}debug(...e){this._log(i7.DEBUG,i9.DEBUG,...e)}info(...e){this._log(i7.INFO,i9.INFO,...e)}warn(...e){this._log(i7.WARN,i9.WARN,...e)}error(...e){this._log(i7.ERROR,i9.ERROR,...e)}addClient(e=console,t=rn,i){if(!e){console.error("Invalid Client SDK");return}if(!this._isValidLevel(t)){console.error("Invalid Log Level");return}let n=Object.assign({},this._defaultMapper);i&&Object.keys(i).filter(this._isValidMethod).forEach(e=>{n[e]=i[e]}),this._clients.push({sdk:e,level:t,mapper:n})}setClientLevel(e,t){if(!this._isValidLevel(e)){console.error("Invalid Log Level");return}if(t){let i=this._clients.findIndex(({sdk:e})=>e===t);if(-1===i){console.error("Client SDK not found");return}this._clients[i].level=e}else for(let t=0,i=this._clients.length;t<i;t++)this._clients[t].level=e}}let ra={api:{endpoint:{config:"https://cdn-4.convertexperiments.com/api/v1/",track:"https://[project_id].metrics.convertexperiments.com/v1/"}},environment:"staging",bucketing:{max_traffic:1e4,hash_seed:9999},data:{},dataStore:null,dataRefreshInterval:3e5,events:{batch_size:10,release_interval:1e3},logger:{logLevel:em.DEBUG,customLoggers:[]},rules:{keys_case_sensitive:!0,comparisonProcessor:null},network:{tracking:!0,cacheLevel:"default"},sdkKey:"",sdkKeySecret:""},ro={logger:{logLevel:em.WARN,customLoggers:[]}},rs={environment:"staging"},rl=(e={})=>nP(ro,rs,ra,e);class ru extends nH{constructor(e={}){var t,i,n;let r=!!(Object.prototype.hasOwnProperty.call(e,"sdkKey")&&(null===(t=e.sdkKey)||void 0===t?void 0:t.length)),a=!!Object.prototype.hasOwnProperty.call(e,"data");r||a||console.error(ny.SDK_OR_DATA_OBJECT_REQUIRED);let o=rl(e);(null==o?void 0:o.network)||(o.network={}),(null===(i=o.network)||void 0===i?void 0:i.source)||(o.network.source="js4.2.0");let s=new rr(console,o.logger.logLevel);for(let e in o.logger.customLoggers)Object.prototype.hasOwnProperty.call(o.logger.customLoggers[e],"logger")&&Object.prototype.hasOwnProperty.call(o.logger.customLoggers[e],"logLevel")?s.addClient(o.logger.customLoggers[e].logger,o.logger.customLoggers[e].logLevel,null===(n=o.logger.customLoggers[e])||void 0===n?void 0:n.methodsMap):s.addClient(o.logger.customLoggers[e],o.logger.logLevel);let l=new n0(o,{loggerManager:s}),u=new nC(o,{eventManager:l,loggerManager:s}),d=new nU(o,{loggerManager:s}),c=new n8(o,{loggerManager:s}),E=new nZ(o,{bucketingManager:d,ruleManager:c,eventManager:l,apiManager:u,loggerManager:s});super(o,{dataManager:E,eventManager:l,experienceManager:new n1(o,{dataManager:E}),featureManager:new n4(o,{dataManager:E,loggerManager:s}),segmentsManager:new ri(o,{dataManager:E,ruleManager:c,loggerManager:s}),apiManager:u,loggerManager:s})}onReady(){return super.onReady()}}i(1772);class rd{constructor(e={}){this.driver=e.driver||"cookie",this.expire=e.expire||36e4,this.store=e.store||"/tmp/demo",this.req=e.req||null,this.res=e.res||null,this.data={},"fs"!==this.driver||(this.fs=i(7147),this.fs.existsSync(this.store)||this.fs.writeFileSync(this.store,"{}"))}get(e){if("fs"===this.driver){if(!this.fs)throw Error("'fs' module is not available on the client side.");this.data=JSON.parse(this.fs.readFileSync(this.store,"utf-8")||"{}")}else"cookie"===this.driver&&this.req&&console.log("window",window);return e?this.data[e.toString()]:this.data}set(e,t){if(!e)throw Error("Invalid DataStore key!");if(this.data[e.toString()]=t,"fs"===this.driver){if(!this.fs)throw Error("'fs' module is not available on the client side.");this.fs.writeFileSync(this.store,JSON.stringify(this.data))}else"cookie"===this.driver&&this.res}}let rc=new ru({sdkKey:"10035569/10034190",dataStore:new rd});async function rE(){try{await rc.onReady(),console.log("SDK Ready");let e="user-id-123",t=rc.createContext(e,{mobile:!1});return t.setDefaultSegments({country:"US"}),new Response(JSON.stringify({success:!0,data:{userId:e,context:t}}),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("SDK Error:",e),new Response(JSON.stringify({error:"SDK Initialization Failed"}),{status:500,headers:{"Content-Type":"application/json"}})}}let rg=new nu.AppRouteRouteModule({definition:{kind:nd.x.APP_ROUTE,page:"/api/convert/route",pathname:"/api/convert",filename:"route",bundlePath:"app/api/convert/route"},resolvedPagePath:"/Users/joe/Desktop/sdk/javascript-sdk/packages/demo-nextjs/src/app/api/convert/route.js",nextConfigOutput:"",userland:nl}),{requestAsyncStorage:r_,staticGenerationAsyncStorage:rh,serverHooks:rO}=rg,rT="/api/convert/route";function rv(){return(0,nc.patchFetch)({serverHooks:rO,staticGenerationAsyncStorage:rh})}},3183:(e,t)=>{t.parse=function(e,t){if("string"!=typeof e)throw TypeError("argument str must be a string");for(var i={},n=(t||{}).decode||r,a=0;a<e.length;){var o=e.indexOf("=",a);if(-1===o)break;var s=e.indexOf(";",a);if(-1===s)s=e.length;else if(s<o){a=e.lastIndexOf(";",o-1)+1;continue}var l=e.slice(a,o).trim();if(void 0===i[l]){var u=e.slice(o+1,s).trim();34===u.charCodeAt(0)&&(u=u.slice(1,-1)),i[l]=function(e,t){try{return t(e)}catch(t){return e}}(u,n)}a=s+1}return i},t.serialize=function(e,t,r){var o=r||{},s=o.encode||a;if("function"!=typeof s)throw TypeError("option encode is invalid");if(!n.test(e))throw TypeError("argument name is invalid");var l=s(t);if(l&&!n.test(l))throw TypeError("argument val is invalid");var u=e+"="+l;if(null!=o.maxAge){var d=o.maxAge-0;if(isNaN(d)||!isFinite(d))throw TypeError("option maxAge is invalid");u+="; Max-Age="+Math.floor(d)}if(o.domain){if(!n.test(o.domain))throw TypeError("option domain is invalid");u+="; Domain="+o.domain}if(o.path){if(!n.test(o.path))throw TypeError("option path is invalid");u+="; Path="+o.path}if(o.expires){var c=o.expires;if("[object Date]"!==i.call(c)&&!(c instanceof Date)||isNaN(c.valueOf()))throw TypeError("option expires is invalid");u+="; Expires="+c.toUTCString()}if(o.httpOnly&&(u+="; HttpOnly"),o.secure&&(u+="; Secure"),o.partitioned&&(u+="; Partitioned"),o.priority)switch("string"==typeof o.priority?o.priority.toLowerCase():o.priority){case"low":u+="; Priority=Low";break;case"medium":u+="; Priority=Medium";break;case"high":u+="; Priority=High";break;default:throw TypeError("option priority is invalid")}if(o.sameSite)switch("string"==typeof o.sameSite?o.sameSite.toLowerCase():o.sameSite){case!0:case"strict":u+="; SameSite=Strict";break;case"lax":u+="; SameSite=Lax";break;case"none":u+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return u};var i=Object.prototype.toString,n=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function r(e){return -1!==e.indexOf("%")?decodeURIComponent(e):e}function a(e){return encodeURIComponent(e)}},1772:function(e,t,i){var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)0>t.indexOf(n[r])&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]]);return i};Object.defineProperty(t,"__esModule",{value:!0}),t.hasCookie=t.deleteCookie=t.setCookie=t.getCookie=t.getCookies=void 0;var a=i(3183),o=function(){return"undefined"!=typeof window},s=function(e){return!!e&&"getAll"in e&&"set"in e&&"function"==typeof e.getAll&&"function"==typeof e.set},l=function(e){return!!(null==e?void 0:e.req)&&"cookies"in e.req&&s(null==e?void 0:e.req.cookies)||!!(null==e?void 0:e.res)&&"cookies"in e.res&&s(null==e?void 0:e.res.cookies)||!!(null==e?void 0:e.cookies)&&s(e.cookies())},u=function(e){var t={};return e.getAll().forEach(function(e){var i=e.name,n=e.value;t[i]=n}),t},d=function(e){try{if("string"==typeof e)return e;return JSON.stringify(e)}catch(t){return e}};t.getCookies=function(e){if(l(e)){if(null==e?void 0:e.req)return u(e.req.cookies);if(null==e?void 0:e.cookies)return u(e.cookies())}if(e&&(t=e.req),!o())return t&&t.cookies?t.cookies:t&&t.headers.cookie?(0,a.parse)(t.headers.cookie):{};for(var t,i={},n=document.cookie?document.cookie.split("; "):[],r=0,s=n.length;r<s;r++){var d=n[r].split("="),c=d.slice(1).join("=");i[d[0]]=c}return i},t.getCookie=function(e,i){var n=(0,t.getCookies)(i)[e];if(void 0!==n)return n?n.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent):n},t.setCookie=function(e,t,i){if(l(i)){var s,u,c,E=i.req,g=i.res,_=i.cookies,h=r(i,["req","res","cookies"]),O=n({name:e,value:d(t)},h);E&&E.cookies.set(O),g&&g.cookies.set(O),_&&_().set(O);return}if(i){var E=i.req,g=i.res,T=r(i,["req","res"]);u=E,c=g,s=T}var v=(0,a.serialize)(e,d(t),n({path:"/"},s));if(o())document.cookie=v;else if(c&&u){var A=c.getHeader("Set-Cookie");if(Array.isArray(A)||(A=A?[String(A)]:[]),c.setHeader("Set-Cookie",A.concat(v)),u&&u.cookies){var f=u.cookies;""===t?delete f[e]:f[e]=d(t)}if(u&&u.headers&&u.headers.cookie){var f=(0,a.parse)(u.headers.cookie);""===t?delete f[e]:f[e]=d(t),u.headers.cookie=Object.entries(f).reduce(function(e,t){return e.concat("".concat(t[0],"=").concat(t[1],";"))},"")}}},t.deleteCookie=function(e,i){return(0,t.setCookie)(e,"",n(n({},i),{maxAge:-1}))},t.hasCookie=function(e,i){return!!e&&(0,t.getCookies)(i).hasOwnProperty(e)}},9303:(e,t,i)=>{e.exports=i(517)}};var t=require("../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),n=t.X(0,[948],()=>i(786));module.exports=n})();