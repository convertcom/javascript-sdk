/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
"use strict";var e=require("@convertcom/utils"),t=require("@convertcom/enums");exports.DataStoreManager=class{constructor(e,{dataStore:t,eventManager:r,loggerManager:a}={}){this.batchSize=1,this.releaseInterval=5e3,this._loggerManager=a,this._eventManager=r,this.batchSize=1,this.releaseInterval=5e3,this.dataStore=t,this._requestsQueue={}}set(e,t){var r,a,s,i;try{null===(a=null===(r=this.dataStore)||void 0===r?void 0:r.set)||void 0===a||a.call(r,e,t)}catch(e){null===(i=null===(s=this._loggerManager)||void 0===s?void 0:s.error)||void 0===i||i.call(s,"DataStoreManager.set()",{error:e.message})}}get(e){var t,r,a,s;try{return null===(r=null===(t=this.dataStore)||void 0===t?void 0:t.get)||void 0===r?void 0:r.call(t,e)}catch(e){null===(s=null===(a=this._loggerManager)||void 0===a?void 0:a.error)||void 0===s||s.call(a,"DataStoreManager.get()",{error:e.message})}return null}enqueue(t,r){var a,s;null===(s=null===(a=this._loggerManager)||void 0===a?void 0:a.trace)||void 0===s||s.call(a,"DataStoreManager.enqueue()",{key:t,data:r});const i={};i[t]=r,this._requestsQueue=e.objectDeepMerge(this._requestsQueue,i),Object.keys(this._requestsQueue).length>=this.batchSize?this.releaseQueue("size"):1===Object.keys(this._requestsQueue).length&&this.startQueue()}releaseQueue(e){var r,a,s,i;null===(a=null===(r=this._loggerManager)||void 0===r?void 0:r.trace)||void 0===a||a.call(r,"DataStoreManager.releaseQueue()",{reason:e||""}),this.stopQueue();for(const e in this._requestsQueue)this.set(e,this._requestsQueue[e]);null===(i=null===(s=this._eventManager)||void 0===s?void 0:s.fire)||void 0===i||i.call(s,t.SystemEvents.DATA_STORE_QUEUE_RELEASED,{reason:e||""})}stopQueue(){clearTimeout(this._requestsQueueTimerID)}startQueue(){this._requestsQueueTimerID=setTimeout((()=>{this.releaseQueue("timeout")}),this.releaseInterval)}set dataStore(e){var r,a;this.isValidDataStore(e)?this._dataStore=e:null===(a=null===(r=this._loggerManager)||void 0===r?void 0:r.error)||void 0===a||a.call(r,t.ERROR_MESSAGES.DATA_STORE_NOT_VALID)}get dataStore(){return this._dataStore}isValidDataStore(e){return e&&"object"==typeof e&&"function"==typeof e.get&&"function"==typeof e.set}};
//# sourceMappingURL=index.min.js.map
