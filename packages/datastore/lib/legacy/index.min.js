/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
"use strict";var e=require("@convertcom/utils"),t=require("@convertcom/enums"),r=function(){function r(e,t){var r=void 0===t?{}:t,a=r.dataStore,o=r.eventManager,i=r.loggerManager;this.batchSize=1,this.releaseInterval=5e3,this._loggerManager=i,this._eventManager=o,this.batchSize=1,this.releaseInterval=5e3,this.dataStore=a,this._requestsQueue={}}return r.prototype.set=function(e,t){var r,a,o,i;try{null===(a=null===(r=this.dataStore)||void 0===r?void 0:r.set)||void 0===a||a.call(r,e,t)}catch(e){null===(i=null===(o=this._loggerManager)||void 0===o?void 0:o.error)||void 0===i||i.call(o,"DataStoreManager.set()",{error:e.message})}},r.prototype.get=function(e){var t,r,a,o;try{return null===(r=null===(t=this.dataStore)||void 0===t?void 0:t.get)||void 0===r?void 0:r.call(t,e)}catch(e){null===(o=null===(a=this._loggerManager)||void 0===a?void 0:a.error)||void 0===o||o.call(a,"DataStoreManager.get()",{error:e.message})}return null},r.prototype.enqueue=function(t,r){var a,o;null===(o=null===(a=this._loggerManager)||void 0===a?void 0:a.trace)||void 0===o||o.call(a,"DataStoreManager.enqueue()",{key:t,data:r});var i={};i[t]=r,this._requestsQueue=e.objectDeepMerge(this._requestsQueue,i),Object.keys(this._requestsQueue).length>=this.batchSize?this.releaseQueue("size"):1===Object.keys(this._requestsQueue).length&&this.startQueue()},r.prototype.releaseQueue=function(e){var r,a,o,i;for(var u in null===(a=null===(r=this._loggerManager)||void 0===r?void 0:r.trace)||void 0===a||a.call(r,"DataStoreManager.releaseQueue()",{reason:e||""}),this.stopQueue(),this._requestsQueue)this.set(u,this._requestsQueue[u]);null===(i=null===(o=this._eventManager)||void 0===o?void 0:o.fire)||void 0===i||i.call(o,t.SystemEvents.DATA_STORE_QUEUE_RELEASED,{reason:e||""})},r.prototype.stopQueue=function(){clearTimeout(this._requestsQueueTimerID)},r.prototype.startQueue=function(){var e=this;this._requestsQueueTimerID=setTimeout((function(){e.releaseQueue("timeout")}),this.releaseInterval)},Object.defineProperty(r.prototype,"dataStore",{get:function(){return this._dataStore},set:function(e){var r,a;this.isValidDataStore(e)?this._dataStore=e:null===(a=null===(r=this._loggerManager)||void 0===r?void 0:r.error)||void 0===a||a.call(r,t.ERROR_MESSAGES.DATA_STORE_NOT_VALID)},enumerable:!1,configurable:!0}),r.prototype.isValidDataStore=function(e){return e&&"object"==typeof e&&"function"==typeof e.get&&"function"==typeof e.set},r}();exports.DataStoreManager=r;
//# sourceMappingURL=index.min.js.map
