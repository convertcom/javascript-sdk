/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
"use strict";var e=require("@convertcom/js-sdk-enums"),t=require("@convertcom/js-sdk-utils"),r=function(){return r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},r.apply(this,arguments)};function n(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,o=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(a)throw a.error}}return i}function a(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var o=function(){function o(e,r){var n=r.dataManager,a=r.ruleManager,o=r.loggerManager;this._dataManager=n,this._ruleManager=a,this._loggerManager=o,this._data=t.objectDeepValue(e,"data")}return o.prototype.getSegments=function(e){var t=this._dataManager.getLocalStore(e)||{};return null==t?void 0:t.segments},o.prototype.putSegments=function(e,t){this._dataManager.putLocalStore(e,{segments:t});var r=this._dataManager.getStoreKey(e);this._dataManager.dataStoreManager.enqueue(r,{segments:t})},o.prototype.setCustomSegments=function(t,o,i){var s,l,u,g,c,d,S,f,v,p=this._dataManager.getLocalStore(t)||{},y=p.segments,h=(void 0===y?{}:y)[e.SegmentsKeys.CUSTOM_SEGMENTS],m=void 0===h?[]:h,M=[],_=!1;try{for(var E=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(o),b=E.next();!b.done;b=E.next()){var O=b.value;if(i&&!_&&(_=this._ruleManager.isRuleMatched(i,null==O?void 0:O.rules),Object.values(e.RuleError).includes(_)))return _;if(!i||_){var T=null===(g=null==O?void 0:O.id)||void 0===g?void 0:g.toString();m.includes(T)?null===(d=null===(c=this._loggerManager)||void 0===c?void 0:c.warn)||void 0===d||d.call(c,e.MESSAGES.CUSTOM_SEGMENTS_KEY_FOUND):M.push(T)}}}catch(e){s={error:e}}finally{try{b&&!b.done&&(l=E.return)&&l.call(E)}finally{if(s)throw s.error}}return M.length?(v=r(r({},p.segments||{}),((u={})[e.SegmentsKeys.CUSTOM_SEGMENTS]=a(a([],n(m),!1),n(M),!1),u)),this.putSegments(t,v)):null===(f=null===(S=this._loggerManager)||void 0===S?void 0:S.warn)||void 0===f||f.call(S,e.MESSAGES.SEGMENTS_NOT_FOUND),v},o.prototype.selectCustomSegments=function(e,t,r){var n=this._dataManager.getEntities(t,"segments");return this.setCustomSegments(e,n,r)},o.prototype.selectCustomSegmentsByIds=function(e,t,r){var n=this._dataManager.getEntitiesByIds(t,"segments");return this.setCustomSegments(e,n,r)},o}();exports.SegmentsManager=o;
//# sourceMappingURL=index.min.js.map
