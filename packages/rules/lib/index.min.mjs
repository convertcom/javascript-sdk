/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
import{Comparisons as e,objectDeepValue as r,arrayNotEmpty as o,camelCase as t}from"@convertcom/js-sdk-utils";import{MESSAGES as s,ERROR_MESSAGES as l,RuleError as i}from"@convertcom/js-sdk-enums";class n{constructor(o,{loggerManager:t}={}){var l,i;this._comparisonProcessor=e,this._negation="!",this._keys_case_sensitive=true,this._loggerManager=t,this._comparisonProcessor=r(o,"rules.comparisonProcessor",e),this._negation=String(r(o,"rules.negation","!")).valueOf(),this._keys_case_sensitive=r(o,"rules.keys_case_sensitive",true,!0),null===(i=null===(l=this._loggerManager)||void 0===l?void 0:l.trace)||void 0===i||i.call(l,s.RULE_CONSTRUCTOR,this)}set comparisonProcessor(e){this._comparisonProcessor=e}get comparisonProcessor(){return this._comparisonProcessor}getComparisonProcessorMethods(){return Object.getOwnPropertyNames(this._comparisonProcessor).filter((e=>"function"==typeof this._comparisonProcessor[e]))}isRuleMatched(e,r){var t,s,i,n;let a;if(null===(s=null===(t=this._loggerManager)||void 0===t?void 0:t.debug)||void 0===s||s.call(t,"RuleManager.isRuleMatched()",{data:e,ruleSet:r}),Object.prototype.hasOwnProperty.call(r,"OR")&&o(null==r?void 0:r.OR)){for(let o=0,t=r.OR.length;o<t;o++)if(a=this._processAND(e,r.OR[o]),!1!==a)return a}else null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.warn)||void 0===n||n.call(i,l.RULE_NOT_VALID);return!1}isValidRule(e){var r,o;return null===(o=null===(r=this._loggerManager)||void 0===r?void 0:r.debug)||void 0===o||o.call(r,"RuleManager.isValidRule()",{rule:e}),Object.prototype.hasOwnProperty.call(e,"matching")&&"object"==typeof e.matching&&Object.prototype.hasOwnProperty.call(e.matching,"match_type")&&"string"==typeof e.matching.match_type&&Object.prototype.hasOwnProperty.call(e.matching,"negated")&&"boolean"==typeof e.matching.negated&&Object.prototype.hasOwnProperty.call(e,"value")}_processAND(e,r){var t,s;let i;if(Object.prototype.hasOwnProperty.call(r,"AND")&&o(null==r?void 0:r.AND)){for(let o=0,t=r.AND.length;o<t;o++)if(i=this._processORWHEN(e,r.AND[o]),!1===i)return!1;return i}return null===(s=null===(t=this._loggerManager)||void 0===t?void 0:t.warn)||void 0===s||s.call(t,l.RULE_NOT_VALID),!1}_processORWHEN(e,r){var t,s;let i;if(Object.prototype.hasOwnProperty.call(r,"OR_WHEN")&&o(null==r?void 0:r.OR_WHEN)){for(let o=0,t=r.OR_WHEN.length;o<t;o++)if(i=this._processRuleItem(e,r.OR_WHEN[o]),!1!==i)return i}else null===(s=null===(t=this._loggerManager)||void 0===t?void 0:t.warn)||void 0===s||s.call(t,l.RULE_NOT_VALID);return!1}_processRuleItem(e,r){var o,s,n,a,c,u;if(this.isValidRule(r))try{const n=r.matching.negated||!1,a=r.matching.match_type;if(-1!==this.getComparisonProcessorMethods().indexOf(a))if("object"==typeof e){if(e.constructor===Object)for(const o of Object.keys(e)){const t=this._keys_case_sensitive?o:o.toLowerCase();if(t===(this._keys_case_sensitive?r.key:r.key.toLowerCase()))return this._comparisonProcessor[a](e[o],r.value,n)}else if(null==r?void 0:r.rule_type)for(const o of Object.getOwnPropertyNames(e.constructor.prototype)){if("constructor"===o)continue;if(o===t(`get ${r.rule_type.replace(/_/g," ")}`)){const t=e[o](r);return Object.values(i).includes(t)||"js_condition"===r.rule_type?t:this._comparisonProcessor[a](t,r.value,n)}}}else null===(s=null===(o=this._loggerManager)||void 0===o?void 0:o.warn)||void 0===s||s.call(o,"RuleManager._processRule()",{warn:l.RULE_DATA_NOT_VALID})}catch(e){null===(a=null===(n=this._loggerManager)||void 0===n?void 0:n.error)||void 0===a||a.call(n,"RuleManager._processRule()",{error:e.message})}else null===(u=null===(c=this._loggerManager)||void 0===c?void 0:c.warn)||void 0===u||u.call(c,l.RULE_NOT_VALID);return!1}}export{n as RuleManager};
//# sourceMappingURL=index.min.mjs.map
