/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
"use strict";var e=require("@convertcom/utils"),r=require("@convertcom/enums");exports.RuleManager=class{constructor(o,{loggerManager:t}={}){var s,a;this._comparisonProcessor=e.Comparisons,this._negation="!",this._keys_case_sensitive=true,this._loggerManager=t,this._comparisonProcessor=e.objectDeepValue(o,"rules.comparisonProcessor",e.Comparisons),this._negation=String(e.objectDeepValue(o,"rules.negation","!")).valueOf(),this._keys_case_sensitive=e.objectDeepValue(o,"rules.keys_case_sensitive",true,!0),null===(a=null===(s=this._loggerManager)||void 0===s?void 0:s.trace)||void 0===a||a.call(s,r.MESSAGES.RULE_CONSTRUCTOR,this)}set comparisonProcessor(e){this._comparisonProcessor=e}get comparisonProcessor(){return this._comparisonProcessor}getComparisonProcessorMethods(){return Object.getOwnPropertyNames(this._comparisonProcessor).filter((e=>"function"==typeof this._comparisonProcessor[e]))}isRuleMatched(o,t){var s,a,l,i;if(null===(a=null===(s=this._loggerManager)||void 0===s?void 0:s.debug)||void 0===a||a.call(s,"RuleManager.isRuleMatched()",{data:o,ruleSet:t}),Object.prototype.hasOwnProperty.call(t,"OR")&&e.arrayNotEmpty(null==t?void 0:t.OR)){for(let e=0,r=t.OR.length;e<r;e++)if(this._processAND(o,t.OR[e]))return!0}else null===(i=null===(l=this._loggerManager)||void 0===l?void 0:l.warn)||void 0===i||i.call(l,r.ERROR_MESSAGES.RULE_NOT_VALID);return!1}isValidRule(e){var r,o;return null===(o=null===(r=this._loggerManager)||void 0===r?void 0:r.debug)||void 0===o||o.call(r,"RuleManager.isValidRule()",{rule:e}),Object.prototype.hasOwnProperty.call(e,"key")&&Object.prototype.hasOwnProperty.call(e,"matching")&&"object"==typeof e.matching&&Object.prototype.hasOwnProperty.call(e.matching,"match_type")&&"string"==typeof e.matching.match_type&&Object.prototype.hasOwnProperty.call(e.matching,"negated")&&"boolean"==typeof e.matching.negated&&Object.prototype.hasOwnProperty.call(e,"value")}_processAND(o,t){var s,a;if(Object.prototype.hasOwnProperty.call(t,"AND")&&e.arrayNotEmpty(null==t?void 0:t.AND)){for(let e=0,r=t.AND.length;e<r;e++)if(!1===this._processORWHEN(o,t.AND[e]))return!1;return!0}return null===(a=null===(s=this._loggerManager)||void 0===s?void 0:s.warn)||void 0===a||a.call(s,r.ERROR_MESSAGES.RULE_NOT_VALID),!1}_processORWHEN(o,t){var s,a;if(Object.prototype.hasOwnProperty.call(t,"OR_WHEN")&&e.arrayNotEmpty(null==t?void 0:t.OR_WHEN)){for(let e=0,r=t.OR_WHEN.length;e<r;e++)if(this._processRule(o,t.OR_WHEN[e]))return!0}else null===(a=null===(s=this._loggerManager)||void 0===s?void 0:s.warn)||void 0===a||a.call(s,r.ERROR_MESSAGES.RULE_NOT_VALID);return!1}_processRule(e,o){var t,s,a,l,i,n;if(this.isValidRule(o))try{const a=o.matching.negated||!1,l=o.matching.match_type;if(-1!==this.getComparisonProcessorMethods().indexOf(l)){if("object"===typeof e)for(const r of Object.keys(e)){const t=this._keys_case_sensitive?r:r.toLowerCase();if(t===(this._keys_case_sensitive?o.key:o.key.toLowerCase()))return this._comparisonProcessor[l](e[r],o.value,a)}else null===(s=null===(t=this._loggerManager)||void 0===t?void 0:t.warn)||void 0===s||s.call(t,"RuleManager._processRule()",{warn:r.ERROR_MESSAGES.RULE_DATA_NOT_VALID})}}catch(e){null===(l=null===(a=this._loggerManager)||void 0===a?void 0:a.error)||void 0===l||l.call(a,"RuleManager._processRule()",{error:e.message})}else null===(n=null===(i=this._loggerManager)||void 0===i?void 0:i.warn)||void 0===n||n.call(i,r.ERROR_MESSAGES.RULE_NOT_VALID);return!1}};
//# sourceMappingURL=index.min.js.map
