/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
"use strict";var e=require("@convertcom/utils"),r=require("@convertcom/enums");function t(e){var r="function"==typeof Symbol&&Symbol.iterator,t=r&&e[r],o=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}var o=function(){function o(t,o){var n,a,i=(void 0===o?{}:o).loggerManager;this._comparisonProcessor=e.Comparisons,this._negation="!",this._keys_case_sensitive=true,this._loggerManager=i,this._comparisonProcessor=e.objectDeepValue(t,"rules.comparisonProcessor",e.Comparisons),this._negation=String(e.objectDeepValue(t,"rules.negation","!")).valueOf(),this._keys_case_sensitive=e.objectDeepValue(t,"rules.keys_case_sensitive",true,!0),null===(a=null===(n=this._loggerManager)||void 0===n?void 0:n.trace)||void 0===a||a.call(n,r.MESSAGES.RULE_CONSTRUCTOR,this)}return Object.defineProperty(o.prototype,"comparisonProcessor",{get:function(){return this._comparisonProcessor},set:function(e){this._comparisonProcessor=e},enumerable:!1,configurable:!0}),o.prototype.getComparisonProcessorMethods=function(){var e=this;return Object.getOwnPropertyNames(this._comparisonProcessor).filter((function(r){return"function"==typeof e._comparisonProcessor[r]}))},o.prototype.isRuleMatched=function(t,o){var n,a,i,l,s;if(null===(a=null===(n=this._loggerManager)||void 0===n?void 0:n.debug)||void 0===a||a.call(n,"RuleManager.isRuleMatched()",{data:t,ruleSet:o}),Object.prototype.hasOwnProperty.call(o,"OR")&&e.arrayNotEmpty(null==o?void 0:o.OR)){for(var c=0,u=o.OR.length;c<u;c++)if(!1!==(s=this._processAND(t,o.OR[c])))return s}else null===(l=null===(i=this._loggerManager)||void 0===i?void 0:i.warn)||void 0===l||l.call(i,r.ERROR_MESSAGES.RULE_NOT_VALID);return!1},o.prototype.isValidRule=function(e){var r,t;return null===(t=null===(r=this._loggerManager)||void 0===r?void 0:r.debug)||void 0===t||t.call(r,"RuleManager.isValidRule()",{rule:e}),Object.prototype.hasOwnProperty.call(e,"matching")&&"object"==typeof e.matching&&Object.prototype.hasOwnProperty.call(e.matching,"match_type")&&"string"==typeof e.matching.match_type&&Object.prototype.hasOwnProperty.call(e.matching,"negated")&&"boolean"==typeof e.matching.negated&&Object.prototype.hasOwnProperty.call(e,"value")},o.prototype._processAND=function(t,o){var n,a,i;if(Object.prototype.hasOwnProperty.call(o,"AND")&&e.arrayNotEmpty(null==o?void 0:o.AND)){for(var l=0,s=o.AND.length;l<s;l++)if(!1===(i=this._processORWHEN(t,o.AND[l])))return!1;return i}return null===(a=null===(n=this._loggerManager)||void 0===n?void 0:n.warn)||void 0===a||a.call(n,r.ERROR_MESSAGES.RULE_NOT_VALID),!1},o.prototype._processORWHEN=function(t,o){var n,a,i;if(Object.prototype.hasOwnProperty.call(o,"OR_WHEN")&&e.arrayNotEmpty(null==o?void 0:o.OR_WHEN)){for(var l=0,s=o.OR_WHEN.length;l<s;l++)if(!1!==(i=this._processRuleItem(t,o.OR_WHEN[l])))return i}else null===(a=null===(n=this._loggerManager)||void 0===n?void 0:n.warn)||void 0===a||a.call(n,r.ERROR_MESSAGES.RULE_NOT_VALID);return!1},o.prototype._processRuleItem=function(o,n){var a,i,l,s,c,u,p,g,_,v;if(this.isValidRule(n))try{var y=n.matching.negated||!1,h=n.matching.match_type;if(-1!==this.getComparisonProcessorMethods().indexOf(h))if("object"==typeof o){if(o.constructor===Object)try{for(var d=t(Object.keys(o)),f=d.next();!f.done;f=d.next()){var R=f.value;if((this._keys_case_sensitive?R:R.toLowerCase())===(this._keys_case_sensitive?n.key:n.key.toLowerCase()))return this._comparisonProcessor[h](o[R],n.value,y)}}catch(e){a={error:e}}finally{try{f&&!f.done&&(i=d.return)&&i.call(d)}finally{if(a)throw a.error}}else if(null==n?void 0:n.rule_type)try{for(var O=t(Object.getOwnPropertyNames(o.constructor.prototype)),m=O.next();!m.done;m=O.next()){var E=m.value;if("constructor"!==E)if(E===e.camelCase("get ".concat(n.rule_type.replace(/_/g," ")))){var b=o[E](n);return Object.values(r.RuleError).includes(b)?b:this._comparisonProcessor[h](b,n.value,y)}}}catch(e){l={error:e}}finally{try{m&&!m.done&&(s=O.return)&&s.call(O)}finally{if(l)throw l.error}}}else null===(u=null===(c=this._loggerManager)||void 0===c?void 0:c.warn)||void 0===u||u.call(c,"RuleManager._processRule()",{warn:r.ERROR_MESSAGES.RULE_DATA_NOT_VALID})}catch(e){null===(g=null===(p=this._loggerManager)||void 0===p?void 0:p.error)||void 0===g||g.call(p,"RuleManager._processRule()",{error:e.message})}else null===(v=null===(_=this._loggerManager)||void 0===_?void 0:_.warn)||void 0===v||v.call(_,r.ERROR_MESSAGES.RULE_NOT_VALID);return!1},o}();exports.RuleManager=o;
//# sourceMappingURL=index.min.js.map
