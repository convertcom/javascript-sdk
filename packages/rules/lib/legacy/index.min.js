/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
"use strict";var e=require("@convertcom/utils"),r=require("@convertcom/enums");var o=function(){function o(o,t){var n,a,i=(void 0===t?{}:t).loggerManager;this._comparisonProcessor=e.Comparisons,this._negation="!",this._keys_case_sensitive=true,this._loggerManager=i,this._comparisonProcessor=e.objectDeepValue(o,"rules.comparisonProcessor",e.Comparisons),this._negation=String(e.objectDeepValue(o,"rules.negation","!")).valueOf(),this._keys_case_sensitive=e.objectDeepValue(o,"rules.keys_case_sensitive",true,!0),null===(a=null===(n=this._loggerManager)||void 0===n?void 0:n.trace)||void 0===a||a.call(n,r.MESSAGES.RULE_CONSTRUCTOR,this)}return Object.defineProperty(o.prototype,"comparisonProcessor",{get:function(){return this._comparisonProcessor},set:function(e){this._comparisonProcessor=e},enumerable:!1,configurable:!0}),o.prototype.getComparisonProcessorMethods=function(){var e=this;return Object.getOwnPropertyNames(this._comparisonProcessor).filter((function(r){return"function"==typeof e._comparisonProcessor[r]}))},o.prototype.isRuleMatched=function(o,t){var n,a,i,l;if(null===(a=null===(n=this._loggerManager)||void 0===n?void 0:n.debug)||void 0===a||a.call(n,"RuleManager.isRuleMatched()",{data:o,ruleSet:t}),Object.prototype.hasOwnProperty.call(t,"OR")&&e.arrayNotEmpty(null==t?void 0:t.OR)){for(var s=0,c=t.OR.length;s<c;s++)if(this._processAND(o,t.OR[s]))return!0}else null===(l=null===(i=this._loggerManager)||void 0===i?void 0:i.warn)||void 0===l||l.call(i,r.ERROR_MESSAGES.RULE_NOT_VALID);return!1},o.prototype.isValidRule=function(e){var r,o;return null===(o=null===(r=this._loggerManager)||void 0===r?void 0:r.debug)||void 0===o||o.call(r,"RuleManager.isValidRule()",{rule:e}),Object.prototype.hasOwnProperty.call(e,"key")&&Object.prototype.hasOwnProperty.call(e,"matching")&&"object"==typeof e.matching&&Object.prototype.hasOwnProperty.call(e.matching,"match_type")&&"string"==typeof e.matching.match_type&&Object.prototype.hasOwnProperty.call(e.matching,"negated")&&"boolean"==typeof e.matching.negated&&Object.prototype.hasOwnProperty.call(e,"value")},o.prototype._processAND=function(o,t){var n,a;if(Object.prototype.hasOwnProperty.call(t,"AND")&&e.arrayNotEmpty(null==t?void 0:t.AND)){for(var i=0,l=t.AND.length;i<l;i++)if(!1===this._processORWHEN(o,t.AND[i]))return!1;return!0}return null===(a=null===(n=this._loggerManager)||void 0===n?void 0:n.warn)||void 0===a||a.call(n,r.ERROR_MESSAGES.RULE_NOT_VALID),!1},o.prototype._processORWHEN=function(o,t){var n,a;if(Object.prototype.hasOwnProperty.call(t,"OR_WHEN")&&e.arrayNotEmpty(null==t?void 0:t.OR_WHEN)){for(var i=0,l=t.OR_WHEN.length;i<l;i++)if(this._processRule(o,t.OR_WHEN[i]))return!0}else null===(a=null===(n=this._loggerManager)||void 0===n?void 0:n.warn)||void 0===a||a.call(n,r.ERROR_MESSAGES.RULE_NOT_VALID);return!1},o.prototype._processRule=function(e,o){var t,n,a,i,l,s,c,u;if(this.isValidRule(o))try{var p=o.matching.negated||!1,g=o.matching.match_type;if(-1!==this.getComparisonProcessorMethods().indexOf(g))if("object"===typeof e)try{for(var _=function(e){var r="function"==typeof Symbol&&Symbol.iterator,o=r&&e[r],t=0;if(o)return o.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&t>=e.length&&(e=void 0),{value:e&&e[t++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}(Object.keys(e)),h=_.next();!h.done;h=_.next()){var v=h.value;if((this._keys_case_sensitive?v:v.toLowerCase())===(this._keys_case_sensitive?o.key:o.key.toLowerCase()))return this._comparisonProcessor[g](e[v],o.value,p)}}catch(e){t={error:e}}finally{try{h&&!h.done&&(n=_.return)&&n.call(_)}finally{if(t)throw t.error}}else null===(i=null===(a=this._loggerManager)||void 0===a?void 0:a.warn)||void 0===i||i.call(a,"RuleManager._processRule()",{warn:r.ERROR_MESSAGES.RULE_DATA_NOT_VALID})}catch(e){null===(s=null===(l=this._loggerManager)||void 0===l?void 0:l.error)||void 0===s||s.call(l,"RuleManager._processRule()",{error:e.message})}else null===(u=null===(c=this._loggerManager)||void 0===c?void 0:c.warn)||void 0===u||u.call(c,r.ERROR_MESSAGES.RULE_NOT_VALID);return!1},o}();exports.RuleManager=o;
//# sourceMappingURL=index.min.js.map
